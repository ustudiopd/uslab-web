# 완료된 작업 내역 (Progress)

## [2024-12-20] Plan/Act 워크플로우 및 스키마 분리 기반 설정
- **Plan/Act 워크플로우 초기화**: 프로젝트 루트에 `.cursorrules`, `plan.md` 템플릿, `memory_bank` 디렉토리 및 기본 문서 생성 완료
- **메모리 뱅크 문서 작성**: 
  - `projectbrief.md`: USLab.ai 프로젝트 목표, 핵심 기능, 타겟 사용자 정의
  - `techContext.md`: 기술 스택 정보 및 Supabase 스키마 분리 전략 추가
  - `systemPatterns.md`: 다중 프로젝트 스키마 분리 패턴 및 코딩 컨벤션 정의
  - `activeContext.md`: 현재 작업 상황 및 다음 예정 작업 기록
- **스키마 분리 전략 수립**: `uslab_` prefix 기반 스키마 분리 전략 확정
  - 테이블, 함수, 트리거, RLS 정책, 인덱스 모두 `uslab_` prefix 사용
  - ustudio 프로젝트(`ustudio_` prefix)와 완전 분리 보장
- **코드 기반 구조 생성**:
  - `lib/supabase/client.ts`: Supabase 클라이언트 설정 (환경 변수 검증 포함)
  - `lib/queries/index.ts`: uslab 전용 쿼리 헬퍼 함수 (prefix 자동 적용)
  - `lib/types/uslab.ts`: TypeScript 타입 정의 구조
  - `supabase/migrations/`: 마이그레이션 디렉토리 생성
  - `README.md`: 프로젝트 개요 및 스키마 분리 전략 문서화

## [2024-12-20] Next.js 14 웹사이트 구축 완료
- **HTML을 Next.js로 변환**: 제공된 HTML을 Next.js 14 App Router 구조로 완전 변환
- **프로젝트 설정 완료**:
  - `package.json`: Next.js 14, TypeScript, Tailwind CSS 등 의존성 설정
  - `tsconfig.json`: TypeScript 설정
  - `tailwind.config.ts`: 커스텀 색상 및 폰트 설정
  - `next.config.mjs`: Next.js 설정
- **컴포넌트 구조 생성**:
  - `components/Navbar.tsx`: 반응형 네비게이션 (모바일 메뉴 포함)
  - `components/Footer.tsx`: 푸터 컴포넌트
  - `components/SmoothScroll.tsx`: 스무스 스크롤 처리
  - `components/sections/Hero.tsx`: Hero 섹션
  - `components/sections/Philosophy.tsx`: Philosophy 섹션 (4가지 전략)
  - `components/sections/Services.tsx`: Services 섹션 (3가지 솔루션)
  - `components/sections/Portfolio.tsx`: Portfolio 섹션 (성공 사례)
  - `components/sections/Contact.tsx`: Contact 섹션 (Supabase 연동)
- **전역 스타일 및 레이아웃**:
  - `app/globals.css`: 커스텀 스크롤바, 그리드 패턴, 텍스트 그라디언트 등
  - `app/layout.tsx`: Google Fonts 최적화 (Noto Sans KR, JetBrains Mono)
  - `app/page.tsx`: 모든 섹션 통합
- **Supabase 연동**:
  - `lib/types/uslab.ts`: `uslab_inquiries` 테이블 타입 정의 추가
  - `components/sections/Contact.tsx`: 문의 폼 Supabase 연동 구현
  - `supabase/migrations/20241220_create_uslab_inquiries.sql`: 문의 테이블 마이그레이션 파일 생성
- **타입 오류 수정**:
  - Contact 컴포넌트의 Supabase insert 타입 오류 해결
  - queries/index.ts의 타입 오류 해결
- **GitHub 리포지토리 생성 및 배포**:
  - GitHub 리포지토리 생성: https://github.com/ustudiopd/uslab-web
  - 초기 커밋 및 푸시 완료
  - Vercel 자동 배포 설정 완료
- **빌드 테스트 성공**:
  - 로컬 빌드 테스트 통과
  - 타입 체크 통과
  - 정적 페이지 생성 완료 (4/4)
  - 빌드 최적화 완료

## [2024-12-20] 다국어 지원 (KOR/ENG) 구현 완료
- **i18n 인프라 구축**:
  - `lib/i18n/config.ts`: 언어 설정 및 타입 정의 (ko, en)
  - `lib/i18n/context.tsx`: LanguageContext 및 Provider 구현
    - React Context API 기반 상태 관리
    - localStorage를 통한 언어 선택 저장
    - 브라우저 언어 자동 감지
    - `useMemo`, `useCallback`을 활용한 성능 최적화
  - `lib/i18n/hooks.ts`: 편의용 훅 export
  - `lib/i18n/translations/ko.json`: 한국어 번역 파일
  - `lib/i18n/translations/en.json`: 영어 번역 파일
- **번역 파일 구조**:
  - 모든 UI 텍스트를 구조화된 JSON 형식으로 관리
  - 섹션별로 그룹화 (nav, hero, philosophy, services, portfolio, contact, footer, meta)
  - 배열 데이터 지원 (`getArray` 함수)
- **컴포넌트 리팩토링**:
  - `app/layout.tsx`: LanguageProvider 추가
  - `components/Navbar.tsx`: 언어 전환 버튼 추가 (데스크톱/모바일)
  - `components/sections/Hero.tsx`: 모든 텍스트 번역 적용
  - `components/sections/Philosophy.tsx`: 전략 섹션 번역 적용
  - `components/sections/Services.tsx`: 서비스 항목 및 태그 번역 적용
  - `components/sections/Portfolio.tsx`: 포트폴리오 케이스 번역 적용
  - `components/sections/Contact.tsx`: 폼 레이블 및 메시지 번역 적용
  - `components/Footer.tsx`: 푸터 텍스트 번역 적용
- **에러 처리**:
  - `app/error.tsx`: 에러 경계 컴포넌트 생성
  - `app/not-found.tsx`: 404 페이지 컴포넌트 생성
- **주요 기능**:
  - 언어 전환: Navbar에서 KOR/ENG 토글 버튼
  - 언어 저장: localStorage에 선택 언어 저장 (새로고침 후에도 유지)
  - 브라우저 언어 감지: 초기 로드 시 자동 감지
  - HTML lang 속성: 언어 변경 시 동적 업데이트
  - SSR 호환: 서버 사이드 렌더링 지원
- **테스트 및 검증**:
  - 빌드 테스트 통과
  - 언어 전환 기능 정상 작동 확인
  - 모든 컴포넌트 번역 적용 확인

## [2025-01-01] 블로그 에디터 시스템 구현 (Phase 1-2 완료)
- **블로그 인프라 구축**:
  - `supabase/migrations/20250101_create_uslab_blog_tables.sql`: 블로그 테이블 마이그레이션 생성
    - `uslab_posts`: 포스트 테이블 (slug, title, content, locale, seo_*, is_published 등)
    - `uslab_post_versions`: 버전 관리 테이블
    - RLS 정책 설정 (공개 읽기, 인증된 사용자만 작성/수정/삭제)
    - 인덱스 및 트리거 설정
  - `lib/types/blog.ts`: 블로그 관련 TypeScript 타입 정의
  - `lib/queries/posts.ts`: Supabase 쿼리 함수 (CRUD, 페이지네이션, 다국어 지원)
- **에디터 통합 (Phase 1)**:
  - Novel.sh 에디터 통합 (`novel` 패키지 설치)
  - `app/admin/posts/write/page.tsx`: 포스트 작성 페이지
    - Novel.sh EditorRoot, EditorContent 사용
    - 제목, slug, 언어 선택 UI
    - 초안 저장 및 발행 기능
  - `app/admin/posts/page.tsx`: 포스트 관리 페이지 (목록, 수정, 삭제)
  - `app/admin/posts/[id]/page.tsx`: 포스트 수정 페이지
- **API 라우트**:
  - `app/api/posts/route.ts`: 포스트 목록 조회 (GET), 생성 (POST)
  - `app/api/posts/[id]/route.ts`: 포스트 조회/수정/삭제
- **인증 시스템**:
  - `lib/hooks/useAuth.ts`: Supabase 인증 훅 (useAuth)
  - `app/admin/login/page.tsx`: 관리자 로그인 페이지
- **블로그 컴포넌트**:
  - `components/blog/PostViewer.tsx`: 포스트 뷰어 (Tiptap JSON → HTML 변환)
  - `components/blog/PostCard.tsx`: 포스트 카드 컴포넌트
  - `components/blog/PostList.tsx`: 포스트 목록 컴포넌트
- **완료된 기능**:
  - ✅ Novel.sh 에디터 기본 통합
  - ✅ 포스트 CRUD 기능 (생성, 조회, 수정, 삭제)
  - ✅ 다국어 지원 (ko/en)
  - ✅ 초안/발행 상태 관리
  - ✅ 인증 기반 관리자 페이지
  - ✅ SEO 필드 구조 (seo_title, seo_description, seo_keywords)
- **Phase 3: AI 기능 (일부 완료)**:
  - ✅ AI 관련 패키지 설치 (`ai`, `@ai-sdk/google`)
  - ✅ AI Slug 생성 API (`/api/ai/slug`) 구현
    - Gemini 2.0 Flash 모델 사용
    - 의미 기반 영문 slug 자동 생성 (SEO 최적화)
    - 제목 입력 시 자동 생성 또는 수동 생성 버튼
  - ❌ AI 이어쓰기 (`/api/ai/generate`)
  - ❌ AI 교정 (`/api/ai/refine`)
  - ❌ SEO 자동 생성 (`/api/ai/seo`)
  - ❌ AI Copilot UI 컴포넌트
- **UI/UX 개선**:
  - ✅ 편집 페이지에 "취소" 및 "목록으로 돌아가기" 버튼 추가
  - ✅ 작성 페이지에 "취소" 및 "목록으로 돌아가기" 버튼 추가
  - ✅ 취소 버튼: 변경사항을 원본 데이터로 되돌리기
  - ✅ 모바일 버전 최적화 (관리자 페이지)
    - 반응형 텍스트 크기 조정
    - 버튼 레이아웃 모바일 최적화
    - 에디터 높이 및 패딩 조정
- **메인페이지 레이아웃 최적화 (2025-01-12)**:
  - ✅ 제목 두 줄 분리 (모바일 최적화)
    - Portfolio 섹션: "결과로 증명하는" / "USlab.ai의 전문성"
    - Services 섹션: "당신의 성공을 위한" / "3가지 솔루션"
    - Philosophy 섹션: "무엇이 USlab.ai를" / "특별하게 만드는가?"
  - ✅ 그라디언트 효과 적용 (Tailwind 유틸리티 사용)
    - 두 번째 줄 제목에 cyan-to-indigo 그라디언트 적용
  - ✅ 한글 텍스트 줄바꿈 개선
    - `korean-text` CSS 클래스 추가 (`globals.css`)
    - `word-break: keep-all` - 한글 단어 중간에 잘리지 않도록
    - `overflow-wrap: break-word` - 긴 단어 자연스러운 줄바꿈
    - Contact 섹션 설명 텍스트에 적용

## [2025-12-13] 블로그 조회수 카운터 기능 구현 완료
- **조회수 추적 시스템 구축**:
  - `supabase/migrations/20251213_add_blog_view_counter.sql`: 조회수 기능 마이그레이션 생성
    - `uslab_posts.view_count` 컬럼 추가 (INTEGER, 기본값 0)
    - 조회수 인덱스 생성 (`uslab_idx_posts_view_count`)
    - `uslab_increment_view_count(UUID)` 함수 생성 (원자적 증가, SECURITY DEFINER)
    - 발행된 포스트만 조회수 증가 (`is_published = true`)
  - `app/api/posts/[id]/view/route.ts`: 조회수 증가 API 엔드포인트 생성
    - POST 메서드로 조회수 증가
    - 공개 API (인증 불필요)
    - 에러 처리 및 로깅
  - `components/blog/PostViewer.tsx`: 조회수 자동 증가 및 표시 기능 추가
    - 포스트 페이지 로드 시 자동으로 조회수 증가 (한 번만 실행)
    - 발행일 옆에 조회수 아이콘 및 숫자 표시
    - 중복 증가 방지 (useRef 사용)
- **완료된 기능**:
  - ✅ 조회수 컬럼 및 인덱스 추가
  - ✅ 원자적 조회수 증가 함수 (동시성 문제 방지)
  - ✅ 조회수 증가 API 엔드포인트
  - ✅ 프론트엔드 자동 조회수 증가
  - ✅ 조회수 UI 표시
  - ✅ 어드민 포스트 관리 목록에 조회수 표시 (기존 구현)

## [2025-12-13] 블로그 에디터 Small 태그 및 링크/이미지 기능 개선
- **Small 태그 기능 추가**:
  - `components/editor/extensions/Small.ts`: Small 태그 지원 extension 생성
    - Tiptap Mark extension으로 `<small>` 태그 지원
    - 타입 선언 추가 (`@tiptap/core` Commands 인터페이스 확장)
    - 키보드 단축키: `Ctrl/Cmd + Shift + S`
  - `components/editor/BlogEditor.tsx`: Small extension 추가
  - `components/blog/PostViewer.tsx`: Small extension 추가 및 CSS 스타일 적용
    - `prose-small:text-xs` 클래스로 작은 글씨 스타일 적용
- **버블 메뉴에 폰트 작게 버튼 추가**:
  - `components/editor/BubbleMenu.tsx`: Type 아이콘을 사용한 Small 토글 버튼 추가
    - 텍스트 선택 시 버블 메뉴에서 폰트 작게 적용 가능
    - `setSmall()`/`unsetSmall()` 명령어 사용
    - 활성 상태 표시 (배경색 변경)
- **슬래시 커맨드 정리**:
  - `components/editor/extensions.tsx`: Small Text 항목 제거 (버블 메뉴에서만 사용)
- **링크 새창 열기 기능 개선**:
  - `components/blog/PostViewer.tsx`: 링크 새창 열기 기능 개선
    - Tiptap Link extension 명시적 추가
    - URL 텍스트를 자동으로 링크로 변환하는 기능 추가
    - 모든 링크에 `target="_blank"` 및 `rel="noopener noreferrer"` 자동 적용
    - MutationObserver를 사용하여 동적으로 추가되는 링크도 처리
- **이미지 라이트박스 모달 기능 추가**:
  - `components/blog/PostViewer.tsx`: 이미지 클릭 시 전체화면 모달 표시
    - 이미지 클릭 시 라이트박스 모달 열기
    - 닫기 버튼 추가 (우측 상단)
    - ESC 키로 모달 닫기
    - 배경 클릭으로 모달 닫기
    - 이미지 최대 크기 제한 (90vw, 90vh)
- **완료된 기능**:
  - ✅ Small 태그 extension 생성 및 통합
  - ✅ 버블 메뉴에 폰트 작게 버튼 추가
  - ✅ 링크 새창 열기 기능 개선
  - ✅ URL 텍스트 자동 링크 변환
  - ✅ 이미지 라이트박스 모달 기능

## [2025-01-02] 블로그 댓글 시스템 구현 완료
- **댓글 테이블 마이그레이션**:
  - `supabase/migrations/20250102_create_uslab_comments.sql`: 댓글 테이블 마이그레이션 생성
  - `uslab_comments` 테이블 생성 (id, post_id, author_name, password_hash, content, is_approved, created_at, updated_at)
  - Foreign key 제약조건 설정 (`uslab_posts` 참조)
  - 인덱스 생성 (post_id, is_approved)
  - RLS 정책 설정 (공개 읽기/쓰기, 수정/삭제는 API 레벨에서 비밀번호 확인)
  - GRANT 권한 부여 (anon, authenticated, service_role)
  - ⚠️ **중요**: 마이그레이션은 **ustudio 프로젝트**(`gzguucdzsrfypbkqlyku`)에 적용됨
- **댓글 API 라우트**:
  - `app/api/comments/route.ts`: 댓글 목록 조회 (GET), 댓글 작성 (POST)
  - `app/api/comments/[id]/route.ts`: 댓글 수정 (PATCH), 댓글 삭제 (DELETE)
  - 비밀번호 해시 처리 (SHA-256)
  - 비밀번호 확인 후 수정/삭제 가능
- **댓글 UI 컴포넌트**:
  - 블로그 포스트 페이지에 댓글 섹션 통합
  - 댓글 작성 폼 (이름, 비밀번호, 댓글 내용)
  - 댓글 목록 표시 (승인된 댓글만)
  - 댓글 수정/삭제 기능
- **프로젝트 구조 명확화**:
  - ⚠️ **중요**: uslab.ai는 독립적인 Supabase 프로젝트가 **아니며**, ustudio 프로젝트(`gzguucdzsrfypbkqlyku`) 내에서 prefix로 구분되는 하나의 웹사이트입니다.
  - ustudio 프로젝트에 3개 웹사이트가 함께 사용됨:
    - `ustudio.co.kr` (ustudio_ prefix)
    - `modoolucture` (modu_ prefix)
    - `uslab.ai` (uslab_ prefix)

## [2025-01-15] 블로그 KO/EN 버전 탭 및 자동 번역 기능 구현 완료
- **KO/EN 버전 탭 시스템 구축**:
  - `components/admin/PostVersionTabs.tsx`: KO/EN 버전 탭 컴포넌트 생성
    - KO/EN 포스트 로드 및 탭 전환 기능
    - 상태 배지 표시 (발행됨/초안/없음)
    - 번역 완료 후 자동 EN 탭 전환
  - `components/admin/TranslateActions.tsx`: 번역 액션 컴포넌트 생성
    - Create 모드: "영문 번역으로 초안 생성" 버튼
    - Update 모드: "자동 번역 업데이트" 버튼
    - Rebase 옵션: "KO 구조로 재생성" 버튼
    - 에러 처리 및 모달 (409 구조 mismatch 시 rebase 옵션 제시)
- **번역 API 라우트 구현**:
  - `app/api/ai/translate-post/route.ts`: 번역 API 엔드포인트 생성
    - Create 모드: KO 구조 복제 + 텍스트만 번역
    - Update 모드: 경로 기반 매칭(80% 이상) → 순서 기반 fallback(50~80%) → 409 에러(50% 미만)
    - Rebase 모드: KO 구조로 완전 재생성
    - 제목, SEO 제목, SEO 설명 번역 포함
    - Gemini 2.0 Flash 모델 사용
    - 청크 분할 + 병렬 처리로 성능 최적화
- **번역 유틸리티 함수**:
  - `lib/translate/tiptapSegments.ts`: Tiptap JSON 번역 처리 유틸리티
    - `collectTranslatableTextNodes`: 번역 대상 텍스트 노드 수집 (codeBlock, inline code 제외)
    - `applyTranslationsByPath`: Create 모드용 경로 기반 번역 적용
    - `applyTranslationsByIndex`: Update 모드용 인덱스 기반 번역 적용
    - `applyTranslationsByPathMatch`: Update 모드용 경로 매칭 번역 적용
    - `calculatePathMatchRate`: 경로 기반 매칭률 계산
- **관리자 편집 화면 통합**:
  - `app/admin/posts/[id]/page.tsx`: PostVersionTabs 컴포넌트 통합
    - 언어 선택 라디오 버튼을 탭으로 대체
    - 탭 전환 시 포스트 자동 로드
    - 번역 완료 후 자동 EN 탭 전환 및 편집 화면 업데이트
- **제목 번역 기능**:
  - `translateTitle` 함수 추가: 제목, SEO 제목, SEO 설명 별도 번역
  - Create/Update 모드 모두에서 제목 번역 적용
  - 기술 용어 유지 (SOP, LLM, agent, USlab.ai 등)
- **완료된 기능**:
  - ✅ KO/EN 버전 탭 UI
  - ✅ Create 모드: KO 구조 복제 + 텍스트 번역
  - ✅ Update 모드: EN 이미지 유지 + 텍스트만 업데이트
  - ✅ 경로 기반 매칭 + 순서 기반 fallback
  - ✅ 구조 mismatch 처리 (409 에러 + rebase 옵션)
  - ✅ 제목 번역 (title, seo_title, seo_description)
  - ✅ 번역 완료 후 자동 EN 탭 전환
  - ✅ 청크 분할 + 병렬 처리 성능 최적화

