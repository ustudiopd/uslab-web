# íˆíŠ¸ë§µ v2 ëª…ì„¸ì„œ ê²€í†  ë³´ê³ ì„œ

**ì‘ì„±ì¼**: 2025-01-25  
**ê²€í†  ëŒ€ìƒ**: `íˆíŠ¸ë§µê²€í† .md` (USLab Heatmap v2 ëª…ì„¸ì„œ)  
**í˜„ì¬ êµ¬í˜„ ìƒíƒœ**: MVP ì™„ë£Œ (20Ã—20 ê·¸ë¦¬ë“œ, fillRect ë Œë”ë§)

---

## 1. ëª…ì„¸ì„œ ìš”ì•½

### ëª©í‘œ
1. ìŠ¤í¬ë¡¤/ê¸´ í˜ì´ì§€ì—ì„œë„ ì •í™•í•œ ì¢Œí‘œë¡œ í´ë¦­ ë¶„í¬ ì¬í˜„
2. 20Ã—20 ê·¸ë¦¬ë“œ fillRect â†’ Blur ëˆ„ì  + Colorize Blob íˆíŠ¸ë§µ
3. ì™¸ë¶€ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì—†ì´ ìˆœìˆ˜ Canvas API ì‚¬ìš©
4. ì„œë²„ ì§‘ê³„(bin) ìœ ì§€ë¡œ ì „ì†¡ëŸ‰/ë Œë” ë¶€í•˜ ì œì–´

### í•µì‹¬ ë³€ê²½ì 
- **A. ìˆ˜ì§‘ ë°ì´í„° í™•ì¥**: `page_x`, `page_y`, `doc_w`, `doc_h`, `scroll_x`, `scroll_y`, `device_bucket` ì¶”ê°€
- **B. ì„œë²„ ì§‘ê³„ ê³ í•´ìƒë„**: 20Ã—20 â†’ 200Ã—200 (ê¸°ë³¸)
- **C. ë Œë”ë§ ì•Œê³ ë¦¬ì¦˜**: fillRect â†’ Blur ëˆ„ì  + Colorize
- **D. ìº”ë²„ìŠ¤ ì „ëµ**: ë¬¸ì„œ ì „ì²´ í¬ê¸° â†’ ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤

---

## 2. ê¸°ìˆ ì  íƒ€ë‹¹ì„± ê²€í† 

### âœ… 2.1 ì¢Œí‘œ ì‹œìŠ¤í…œ í™•ì¥ (Aí•­ëª©)

**ëª…ì„¸ì„œ ì œì•ˆ**:
```typescript
page_x = (event.clientX + window.scrollX) / docWidth
page_y = (event.clientY + window.scrollY) / docHeight
doc_w = Math.max(documentElement.scrollWidth, body.scrollWidth, innerWidth)
doc_h = Math.max(documentElement.scrollHeight, body.scrollHeight, innerHeight)
```

**í˜„ì¬ êµ¬í˜„**:
```typescript
x = event.clientX / viewportW  // ë·°í¬íŠ¸ ê¸°ì¤€ë§Œ
y = event.clientY / viewportH   // ìŠ¤í¬ë¡¤ ë¯¸í¬í•¨
```

**ê²€í†  ê²°ê³¼**: âœ… **ì™„ì „íˆ íƒ€ë‹¹í•¨**

- **ë¬¸ì œì  ì •í™•íˆ ì§€ì **: í˜„ì¬ êµ¬í˜„ì€ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ë¥¼ ê³ ë ¤í•˜ì§€ ì•Šì•„ ê¸´ í˜ì´ì§€ì—ì„œ ìœ„ì¹˜ ë¶ˆì¼ì¹˜ ë°œìƒ
- **í•´ê²°ì±… ì ì ˆ**: ë¬¸ì„œ ê¸°ì¤€ ì¢Œí‘œ(`page_x`, `page_y`) ì¶”ê°€ë¡œ ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³´ì • ê°€ëŠ¥
- **í•˜ìœ„ í˜¸í™˜ì„±**: ê¸°ì¡´ `x`, `y` ìœ ì§€ë¡œ ë ˆê±°ì‹œ ë°ì´í„° í˜¸í™˜ ê°€ëŠ¥
- **êµ¬í˜„ ë‚œì´ë„**: ğŸŸ¢ **ë‚®ìŒ** - ë‹¨ìˆœ ê³„ì‚° ì¶”ê°€

**ì£¼ì˜ì‚¬í•­**:
- `doc_w`, `doc_h`ëŠ” ë™ì  ì½˜í…ì¸ (ì´ë¯¸ì§€ ë¡œë”© ë“±)ë¡œ ì¸í•´ ë³€ê²½ë  ìˆ˜ ìˆìŒ
- ëª…ì„¸ì„œì—ì„œ `client_ts`ë¥¼ ì±„ìš°ë¼ê³  í–ˆëŠ”ë°, í˜„ì¬ êµ¬í˜„ì— ì´ë¯¸ ì¡´ì¬í•¨ (`Date.now()`)

---

### âœ… 2.2 ì„œë²„ ì§‘ê³„ ê³ í•´ìƒë„í™” (Bí•­ëª©)

**ëª…ì„¸ì„œ ì œì•ˆ**:
- ê¸°ë³¸ `gridSize`: 20 â†’ 200
- Query paramìœ¼ë¡œ ì¡°ì ˆ ê°€ëŠ¥ (`grid=100|200|300`)
- ì¢Œí‘œ ìš°ì„ ìˆœìœ„: `page_x/page_y` â†’ `x/y` (fallback)

**í˜„ì¬ êµ¬í˜„**:
```typescript
const gridSize = 20; // ê³ ì •ê°’
const gridX = Math.floor(x * gridSize);
const gridY = Math.floor(y * gridSize);
```

**ê²€í†  ê²°ê³¼**: âœ… **íƒ€ë‹¹í•˜ë‚˜ ì„±ëŠ¥ ê³ ë ¤ í•„ìš”**

**ì¥ì **:
- í•´ìƒë„ 10ë°° ì¦ê°€ (400ì…€ â†’ 40,000ì…€)
- ë” ì •ë°€í•œ í´ë¦­ ë¶„í¬ ë¶„ì„ ê°€ëŠ¥
- Query paramìœ¼ë¡œ ìœ ì—°ì„± í™•ë³´

**ì ì¬ì  ì´ìŠˆ**:
1. **ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰**: 200Ã—200 = 40,000ì…€ (í˜„ì¬ 400ì…€ ëŒ€ë¹„ 100ë°°)
   - í•˜ì§€ë§Œ ì‹¤ì œë¡œëŠ” "í´ë¦­ì´ ìˆëŠ” binë§Œ" ë°˜í™˜í•˜ë¯€ë¡œ payloadëŠ” í¬ì§€ ì•ŠìŒ
   - ëª…ì„¸ì„œì—ì„œë„ ì´ ì ì„ ì–¸ê¸‰í•¨ âœ…

2. **Supabase 1000í–‰ ì œí•œ**: 
   - í˜„ì¬ APIëŠ” `select('props')`ë¡œ ëª¨ë“  ì´ë²¤íŠ¸ë¥¼ ê°€ì ¸ì˜´
   - ëª…ì„¸ì„œì—ì„œë„ "íŠ¸ë˜í”½ ì»¤ì§€ë©´ RPC ê³ ë ¤" ì–¸ê¸‰ âœ…
   - **í˜„ì¬ëŠ” ë¬¸ì œ ì—†ìœ¼ë‚˜, í–¥í›„ í˜ì´ì§€ë„¤ì´ì…˜ í•„ìš”í•  ìˆ˜ ìˆìŒ**

3. **ì§‘ê³„ ì„±ëŠ¥**:
   - 40,000ì…€ ì§‘ê³„ëŠ” JSì—ì„œë„ ì¶©ë¶„íˆ ë¹ ë¦„ (ìˆ˜ë§Œ ê°œ ì´ë²¤íŠ¸ ê¸°ì¤€)
   - í•˜ì§€ë§Œ 100k ì´ìƒ ì´ë²¤íŠ¸ ì‹œ ì„±ëŠ¥ ì €í•˜ ê°€ëŠ¥
   - ëª…ì„¸ì„œì—ì„œ "ìƒ˜í”Œë§ or ê¸°ê°„ ì¶•ì†Œ ê²½ê³ " ì œì•ˆ âœ…

**êµ¬í˜„ ë‚œì´ë„**: ğŸŸ¢ **ë‚®ìŒ** - ë‹¨ìˆœ íŒŒë¼ë¯¸í„° ë³€ê²½

**ê°œì„  ì œì•ˆ**:
- `gridSize` ë²”ìœ„ ì œí•œ (50~400) ëª…ì‹œ âœ… (ëª…ì„¸ì„œì— í¬í•¨ë¨)
- ì´ë²¤íŠ¸ ìˆ˜ê°€ ë„ˆë¬´ ë§ì„ ë•Œ ê²½ê³  ë©”ì‹œì§€ ì¶”ê°€ ê¶Œì¥

---

### âš ï¸ 2.3 Blob ë Œë”ë§ ì•Œê³ ë¦¬ì¦˜ (Cí•­ëª©)

**ëª…ì„¸ì„œ ì œì•ˆ**:
- Offscreen(shadow) canvasì— ì ë“¤ì„ blurë¡œ ëˆ„ì 
- ëˆ„ì  ì•ŒíŒŒë¥¼ íŒ”ë ˆíŠ¸ë¡œ ë§¤í•‘í•˜ì—¬ ìƒ‰ìƒ ì…í˜
- Stamp canvas(ì›í˜• ê·¸ë¼ë°ì´ì…˜) ë¯¸ë¦¬ ìƒì„± í›„ `drawImage`ë¡œ ë¹ ë¥´ê²Œ ëˆ„ì 

**í˜„ì¬ êµ¬í˜„**:
```typescript
// ë‹¨ìˆœ fillRectë¡œ ê·¸ë¦¬ë“œ ì…€ ì¹ í•˜ê¸°
ctx.fillStyle = `rgba(${r}, ${g}, ${b}, ${a})`;
ctx.fillRect(x, y, cellWidth, cellHeight);
```

**ê²€í†  ê²°ê³¼**: âš ï¸ **íƒ€ë‹¹í•˜ë‚˜ êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ**

**ê¸°ìˆ ì  íƒ€ë‹¹ì„±**: âœ… **ì™„ì „íˆ ê°€ëŠ¥í•¨**

Canvas APIë¡œ Blob íˆíŠ¸ë§µ êµ¬í˜„ì€ í‘œì¤€ì ì¸ ë°©ë²•:
1. **ì›í˜• ê·¸ë¼ë°ì´ì…˜ ìƒì„±**: `createRadialGradient()` ì‚¬ìš©
2. **Blur íš¨ê³¼**: `ctx.filter = 'blur(25px)'` ë˜ëŠ” ìˆ˜ë™ Gaussian blur
3. **ì•ŒíŒŒ ëˆ„ì **: `globalCompositeOperation = 'screen'` ë˜ëŠ” `'lighter'`
4. **Colorize**: `getImageData()`ë¡œ ì•ŒíŒŒ ì½ê³  íŒ”ë ˆíŠ¸ ë§¤í•‘

**êµ¬í˜„ ë³µì¡ë„**: ğŸŸ¡ **ì¤‘ê°„~ë†’ìŒ**

**í•„ìš”í•œ ì‘ì—…**:
1. Stamp canvas ìƒì„± (ì›í˜• ê·¸ë¼ë°ì´ì…˜)
2. Offscreen canvasì— ì  ëˆ„ì  (blur ì ìš©)
3. ì•ŒíŒŒ ê°’ ì½ê¸° (`getImageData()`)
4. íŒ”ë ˆíŠ¸ ë§¤í•‘ (blueâ†’cyanâ†’greenâ†’yellowâ†’red)
5. ë©”ì¸ ìº”ë²„ìŠ¤ì— ìµœì¢… ë Œë”ë§

**ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­**:
- `getImageData()`ëŠ” ë©”ëª¨ë¦¬ ì§‘ì•½ì  (íŠ¹íˆ ê³ í•´ìƒë„)
- Blur í•„í„°ëŠ” GPU ê°€ì†ë˜ì§€ë§Œ, ë§ì€ ì ì—ì„œëŠ” ëŠë¦´ ìˆ˜ ìˆìŒ
- ëª…ì„¸ì„œì—ì„œ "í™”ë©´ ë°– í¬ì¸íŠ¸ skip" ì œì•ˆ âœ…

**êµ¬í˜„ ë‚œì´ë„**: ğŸŸ¡ **ì¤‘ê°„** - Canvas API ìˆ™ë ¨ë„ í•„ìš”

**ì°¸ê³  ìë£Œ**:
- heatmap.js ì˜¤í”ˆì†ŒìŠ¤ êµ¬í˜„ ë°©ì‹ ì°¸ê³  ê°€ëŠ¥ (ë¼ì´ë¸ŒëŸ¬ë¦¬ ì‚¬ìš©ì€ ê¸ˆì§€)
- Canvas composite operations ë¬¸ì„œ ì°¸ê³ 

---

### âœ… 2.4 ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤ (Dí•­ëª©)

**ëª…ì„¸ì„œ ì œì•ˆ**:
- ìº”ë²„ìŠ¤ë¥¼ `100vw Ã— 100vh (fixed)`ë¡œ ê³ ì •
- ìŠ¤í¬ë¡¤ì— ë”°ë¼ ì¢Œí‘œë¥¼ í™”ë©´ìœ¼ë¡œ ë³€í™˜í•´ ë‹¤ì‹œ ê·¸ë¦¬ê¸°
- ë¬¸ì„œ í¬ê¸°(`docW/docH`)ëŠ” "ë³€í™˜ìš©"ìœ¼ë¡œë§Œ ì‚¬ìš©

**í˜„ì¬ êµ¬í˜„**:
```typescript
// ì „ì²´ ë¬¸ì„œ í¬ê¸°ë¡œ ìº”ë²„ìŠ¤ ìƒì„±
canvas.width = docSize.width;
canvas.height = docSize.height;
```

**ê²€í†  ê²°ê³¼**: âœ… **ì™„ì „íˆ íƒ€ë‹¹í•¨**

**ì¥ì **:
1. **ë©”ëª¨ë¦¬ ì ˆì•½**: ë·°í¬íŠ¸ í¬ê¸°ë§Œí¼ë§Œ ë©”ëª¨ë¦¬ ì‚¬ìš© (í˜„ì¬ëŠ” ë¬¸ì„œ ì „ì²´)
2. **ì„±ëŠ¥ í–¥ìƒ**: ì‘ì€ ìº”ë²„ìŠ¤ = ë¹ ë¥¸ ë Œë”ë§
3. **ìŠ¤í¬ë¡¤ ëŒ€ì‘**: ìŠ¤í¬ë¡¤ ì‹œ ì¬ë Œë”ë§ìœ¼ë¡œ í•­ìƒ ì •í™•í•œ ìœ„ì¹˜ í‘œì‹œ

**ì¢Œí‘œ ë³€í™˜ ë¡œì§**:
```typescript
// ë¬¸ì„œ ê¸°ì¤€ ì¢Œí‘œ (0~1) â†’ ë¬¸ì„œ í”½ì…€ ì¢Œí‘œ
docX = nx * docW
docY = ny * docH

// ë¬¸ì„œ í”½ì…€ ì¢Œí‘œ â†’ í™”ë©´ ì¢Œí‘œ
screenX = docX - scrollX
screenY = docY - scrollY
```

**êµ¬í˜„ ë‚œì´ë„**: ğŸŸ¢ **ë‚®ìŒ** - ë‹¨ìˆœ ì¢Œí‘œ ë³€í™˜

**ì£¼ì˜ì‚¬í•­**:
- ìŠ¤í¬ë¡¤/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ `requestAnimationFrame` throttle í•„ìˆ˜ âœ… (ëª…ì„¸ì„œì— í¬í•¨)
- `docW/docH`ëŠ” ë Œë” ì‹œì ì— ì¬ê³„ì‚° í•„ìš” (ë™ì  ì½˜í…ì¸  ëŒ€ì‘)

---

## 3. í˜„ì¬ êµ¬í˜„ê³¼ì˜ í˜¸í™˜ì„±

### âœ… 3.1 ë°ì´í„° ìˆ˜ì§‘ ë ˆì´ì–´

**í˜¸í™˜ì„±**: âœ… **ì™„ë²½ í˜¸í™˜**

- `props`ê°€ JSONBì´ë¯€ë¡œ í‚¤ ì¶”ê°€ë§Œ í•˜ë©´ ë¨
- ê¸°ì¡´ `x`, `y` ìœ ì§€ë¡œ ë ˆê±°ì‹œ ë°ì´í„° í˜¸í™˜
- `trackClick()` í•¨ìˆ˜ë§Œ í™•ì¥í•˜ë©´ ë¨

**ë³€ê²½ íŒŒì¼**:
- `lib/utils/eventTracker.ts`: `trackClick()` í•¨ìˆ˜ í™•ì¥

---

### âœ… 3.2 ì„œë²„ ì§‘ê³„ ë ˆì´ì–´

**í˜¸í™˜ì„±**: âœ… **í•˜ìœ„ í˜¸í™˜ ìœ ì§€**

- ì‘ë‹µ ìŠ¤í‚¤ë§ˆ í™•ì¥ (`stats`ì— `coordMode`, `filteredBy` ì¶”ê°€)
- ê¸°ì¡´ `grid` í˜•ì‹ ìœ ì§€ (`"gx,gy": count`)
- Query param ì¶”ê°€ë¡œ ê¸°ì¡´ í´ë¼ì´ì–¸íŠ¸ ì˜í–¥ ì—†ìŒ

**ë³€ê²½ íŒŒì¼**:
- `app/api/admin/heatmap/[pagePath]/route.ts`: ì§‘ê³„ ë¡œì§ í™•ì¥

---

### âœ… 3.3 í´ë¼ì´ì–¸íŠ¸ ë Œë”ë§ ë ˆì´ì–´

**í˜¸í™˜ì„±**: âš ï¸ **ì£¼ìš” ë³€ê²½ í•„ìš”**

- `HeatmapOverlay.tsx` ì „ì²´ ì•Œê³ ë¦¬ì¦˜ êµì²´ í•„ìš”
- Props ì¸í„°í˜ì´ìŠ¤ëŠ” ìœ ì§€ ê°€ëŠ¥ (`grid`, `gridSize`, `totalClicks`)
- ë‚´ë¶€ ë Œë”ë§ ë¡œì§ ì™„ì „ ì¬ì‘ì„±

**ë³€ê²½ íŒŒì¼**:
- `components/admin/HeatmapOverlay.tsx`: ë Œë”ë§ ì•Œê³ ë¦¬ì¦˜ êµì²´
- `components/admin/HeatmapViewer.tsx`: í•„í„° ì˜µì…˜ ì¶”ê°€

---

## 4. êµ¬í˜„ ìš°ì„ ìˆœìœ„ ë° ë‚œì´ë„ í‰ê°€

### Phase 1: ì¢Œí‘œ ì‹œìŠ¤í…œ í™•ì¥ (í•„ìˆ˜, ë‚œì´ë„: ğŸŸ¢ ë‚®ìŒ)

**ì‘ì—… ë‚´ìš©**:
1. `trackClick()`ì— `page_x`, `page_y`, `doc_w`, `doc_h`, `scroll_x`, `scroll_y`, `device_bucket` ì¶”ê°€
2. `?heatmap=true` ëª¨ë“œì—ì„œ í´ë¦­ ìˆ˜ì§‘ ì œì™¸

**ì˜ˆìƒ ì‹œê°„**: 1-2ì‹œê°„

**ì˜ì¡´ì„±**: ì—†ìŒ

---

### Phase 2: ì„œë²„ ì§‘ê³„ ê³ í•´ìƒë„í™” (í•„ìˆ˜, ë‚œì´ë„: ğŸŸ¢ ë‚®ìŒ)

**ì‘ì—… ë‚´ìš©**:
1. `gridSize` ê¸°ë³¸ê°’ 200ìœ¼ë¡œ ë³€ê²½
2. Query param `grid`, `device` ì¶”ê°€
3. ì¢Œí‘œ ìš°ì„ ìˆœìœ„ ë¡œì§ (`page_x/page_y` â†’ `x/y`)
4. ì‘ë‹µ ìŠ¤í‚¤ë§ˆ í™•ì¥ (`coordMode`, `filteredBy`)

**ì˜ˆìƒ ì‹œê°„**: 2-3ì‹œê°„

**ì˜ì¡´ì„±**: Phase 1 ì™„ë£Œ í•„ìš”

---

### Phase 3: ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤ (í•„ìˆ˜, ë‚œì´ë„: ğŸŸ¢ ë‚®ìŒ)

**ì‘ì—… ë‚´ìš©**:
1. ìº”ë²„ìŠ¤ í¬ê¸°ë¥¼ ë·°í¬íŠ¸ë¡œ ê³ ì • (`100vw Ã— 100vh`)
2. ì¢Œí‘œ ë³€í™˜ ë¡œì§ êµ¬í˜„ (ë¬¸ì„œ ì¢Œí‘œ â†’ í™”ë©´ ì¢Œí‘œ)
3. ìŠ¤í¬ë¡¤/ë¦¬ì‚¬ì´ì¦ˆ ì‹œ ì¬ë Œë”ë§ (`requestAnimationFrame` throttle)

**ì˜ˆìƒ ì‹œê°„**: 2-3ì‹œê°„

**ì˜ì¡´ì„±**: Phase 2 ì™„ë£Œ í•„ìš”

---

### Phase 4: Blob ë Œë”ë§ ì•Œê³ ë¦¬ì¦˜ (í•µì‹¬ ê¸°ëŠ¥, ë‚œì´ë„: ğŸŸ¡ ì¤‘ê°„)

**ì‘ì—… ë‚´ìš©**:
1. Stamp canvas ìƒì„± (ì›í˜• ê·¸ë¼ë°ì´ì…˜)
2. Offscreen canvasì— ì  ëˆ„ì  (blur ì ìš©)
3. ì•ŒíŒŒ ê°’ ì½ê¸° ë° íŒ”ë ˆíŠ¸ ë§¤í•‘
4. ë©”ì¸ ìº”ë²„ìŠ¤ì— ìµœì¢… ë Œë”ë§
5. ì»¨íŠ¸ë¡¤ íŒ¨ë„ì— `radius`, `blur`, `opacity` ì¡°ì ˆ ì¶”ê°€

**ì˜ˆìƒ ì‹œê°„**: 4-6ì‹œê°„

**ì˜ì¡´ì„±**: Phase 3 ì™„ë£Œ í•„ìš”

**ì£¼ì˜ì‚¬í•­**:
- Canvas API ìˆ™ë ¨ë„ í•„ìš”
- ì„±ëŠ¥ ìµœì í™” ì¤‘ìš” (í™”ë©´ ë°– í¬ì¸íŠ¸ skip, throttle)

---

## 5. ì ì¬ì  ì´ìŠˆ ë° í•´ê²° ë°©ì•ˆ

### âš ï¸ 5.1 ì„±ëŠ¥ ì´ìŠˆ

**ë¬¸ì œ**:
- 200Ã—200 ê·¸ë¦¬ë“œ = 40,000ì…€ ì§‘ê³„
- ë§ì€ í´ë¦­ ì´ë²¤íŠ¸ ì‹œ ì§‘ê³„ ì‹œê°„ ì¦ê°€
- Blob ë Œë”ë§ì€ GPU ê°€ì†ë˜ì§€ë§Œ ë§ì€ ì ì—ì„œëŠ” ëŠë¦´ ìˆ˜ ìˆìŒ

**í•´ê²° ë°©ì•ˆ**:
1. âœ… ëª…ì„¸ì„œ ì œì•ˆ: í™”ë©´ ë°– í¬ì¸íŠ¸ skip
2. âœ… ëª…ì„¸ì„œ ì œì•ˆ: `requestAnimationFrame` throttle
3. **ì¶”ê°€ ì œì•ˆ**: ì´ë²¤íŠ¸ ìˆ˜ê°€ ë„ˆë¬´ ë§ì„ ë•Œ ìƒ˜í”Œë§ (ì˜ˆ: ìƒìœ„ 10,000ê°œë§Œ)
4. **ì¶”ê°€ ì œì•ˆ**: Web Workerë¡œ ì§‘ê³„ ì‘ì—… ë¶„ë¦¬ (ì„ íƒì )

---

### âš ï¸ 5.2 ë™ì  ì½˜í…ì¸  ì´ìŠˆ

**ë¬¸ì œ**:
- ì´ë¯¸ì§€ ë¡œë”© ë“±ìœ¼ë¡œ `docW/docH` ë³€ê²½ ê°€ëŠ¥
- ìˆ˜ì§‘ ì‹œì ê³¼ ë Œë”ë§ ì‹œì ì˜ ë¬¸ì„œ í¬ê¸° ë¶ˆì¼ì¹˜

**í•´ê²° ë°©ì•ˆ**:
1. âœ… ëª…ì„¸ì„œ ì œì•ˆ: ë Œë” ì‹œì ì— `docW/docH` ì¬ê³„ì‚°
2. **ì¶”ê°€ ì œì•ˆ**: `ResizeObserver`ë¡œ ë¬¸ì„œ í¬ê¸° ë³€ê²½ ê°ì§€ (í˜„ì¬ êµ¬í˜„ì— ì´ë¯¸ ìˆìŒ)
3. **ì¶”ê°€ ì œì•ˆ**: ìˆ˜ì§‘ ì‹œì ì˜ `doc_w/doc_h`ë¥¼ ì €ì¥í•˜ì—¬ ì •ê·œí™” ì¢Œí‘œ ë³´ì •

---

### âš ï¸ 5.3 Supabase ì¿¼ë¦¬ ì œí•œ

**ë¬¸ì œ**:
- Supabase ê¸°ë³¸ 1000í–‰ ì œí•œ
- ë§ì€ í´ë¦­ ì´ë²¤íŠ¸ ì‹œ ë°ì´í„° ëˆ„ë½ ê°€ëŠ¥

**í•´ê²° ë°©ì•ˆ**:
1. âœ… ëª…ì„¸ì„œ ì œì•ˆ: í–¥í›„ RPCë¡œ ì „í™˜ ê³ ë ¤
2. **í˜„ì¬ í•´ê²°ì±…**: í˜ì´ì§€ë„¤ì´ì…˜ìœ¼ë¡œ ëª¨ë“  ë°ì´í„° ê°€ì ¸ì˜¤ê¸° (ë‹¤ë¥¸ ì¿¼ë¦¬ì—ì„œ ì´ë¯¸ ì ìš© ì¤‘)
3. **ì¶”ê°€ ì œì•ˆ**: ì§‘ê³„ë¥¼ ì„œë²„ ì‚¬ì´ë“œì—ì„œ ìˆ˜í–‰ (PostgreSQL RPC)

---

### âš ï¸ 5.4 ë¸Œë¼ìš°ì € í˜¸í™˜ì„±

**ë¬¸ì œ**:
- Canvas APIëŠ” ëª¨ë“  ë¸Œë¼ìš°ì € ì§€ì›
- í•˜ì§€ë§Œ `filter: blur()`ëŠ” ì¼ë¶€ êµ¬í˜• ë¸Œë¼ìš°ì € ë¯¸ì§€ì›

**í•´ê²° ë°©ì•ˆ**:
1. **ìˆ˜ë™ Gaussian blur êµ¬í˜„**: ëª¨ë“  ë¸Œë¼ìš°ì € í˜¸í™˜
2. **Fallback**: blur ë¯¸ì§€ì› ì‹œ ë‹¨ìˆœ ì›í˜• ê·¸ë¼ë°ì´ì…˜ ì‚¬ìš©
3. **ì°¸ê³ **: í˜„ì¬ ì‚¬ìš©ìì¸µì´ ëª¨ë˜ ë¸Œë¼ìš°ì €ë¼ë©´ ë¬¸ì œ ì—†ì„ ê°€ëŠ¥ì„± ë†’ìŒ

---

## 6. ëª…ì„¸ì„œ ê°œì„  ì œì•ˆ

### âœ… 6.1 ì´ë¯¸ ì˜ ì •ì˜ëœ ë¶€ë¶„

1. **ìµœì†Œ ì¹¨ìŠµ ì›ì¹™**: ê¸°ì¡´ êµ¬ì¡° ìœ ì§€í•˜ë©´ì„œ í™•ì¥ âœ…
2. **í•˜ìœ„ í˜¸í™˜ì„±**: ë ˆê±°ì‹œ ë°ì´í„° í˜¸í™˜ ê³ ë ¤ âœ…
3. **ì„±ëŠ¥ ê°€ë“œ**: í™”ë©´ ë°– í¬ì¸íŠ¸ skip, throttle ì œì•ˆ âœ…
4. **Non-goals ëª…í™•í™”**: ì„¸ì…˜ ë…¹í™” ì œì™¸ âœ…

---

### ğŸ’¡ 6.2 ì¶”ê°€ ì œì•ˆ ì‚¬í•­

#### 6.2.1 ì¢Œí‘œ ì •ê·œí™” ë³´ì • ë¡œì§

**ëª…ì„¸ì„œ**: `page_x = (clientX + scrollX) / docWidth`

**ê°œì„  ì œì•ˆ**: ìˆ˜ì§‘ ì‹œì ì˜ `doc_w/doc_h`ë¥¼ ì €ì¥í•˜ì—¬, ë Œë”ë§ ì‹œì ì˜ ë¬¸ì„œ í¬ê¸°ì™€ ë‹¤ë¥¼ ë•Œ ë³´ì •

```typescript
// ìˆ˜ì§‘ ì‹œì 
page_x = (clientX + scrollX) / doc_w  // ìˆ˜ì§‘ ì‹œì ì˜ doc_w ì‚¬ìš©

// ë Œë”ë§ ì‹œì 
currentDocW = Math.max(...)  // í˜„ì¬ ë¬¸ì„œ í¬ê¸°
if (savedDocW !== currentDocW) {
  // ë¹„ìœ¨ ë³´ì •
  adjustedX = page_x * (savedDocW / currentDocW)
}
```

**ì´ìœ **: ë™ì  ì½˜í…ì¸ (ì´ë¯¸ì§€ ë¡œë”©)ë¡œ ë¬¸ì„œ í¬ê¸°ê°€ ë³€ê²½ë  ìˆ˜ ìˆìŒ

---

#### 6.2.2 ìƒ˜í”Œë§ ì „ëµ ëª…ì‹œ

**ëª…ì„¸ì„œ**: "ì´ë²¤íŠ¸ê°€ ë„ˆë¬´ ë§ì„ ë•Œ ìƒ˜í”Œë§ or ê¸°ê°„ ì¶•ì†Œ ê²½ê³ "

**ê°œì„  ì œì•ˆ**: êµ¬ì²´ì ì¸ ìƒ˜í”Œë§ ì „ëµ ì œì‹œ

```typescript
// ì˜ˆ: ìƒìœ„ Nê°œ binë§Œ ë Œë”ë§
if (bins.length > 20000) {
  bins = bins.sort((a, b) => b.count - a.count).slice(0, 10000);
  stats.warning = 'Too many data points, showing top 10,000 bins';
}
```

---

#### 6.2.3 ë””ë°”ì´ìŠ¤ í•„í„° ê¸°ë³¸ê°’

**ëª…ì„¸ì„œ**: `device: 'all' | 'mobile' | 'desktop'` (default: all)

**ê°œì„  ì œì•ˆ**: í˜„ì¬ ë·°í¬íŠ¸ í¬ê¸°ì— ë”°ë¼ ê¸°ë³¸ê°’ ìë™ ì„¤ì •

```typescript
// HeatmapViewerì—ì„œ
const defaultDevice = window.innerWidth < 768 ? 'mobile' : 'desktop';
```

---

#### 6.2.4 Blur êµ¬í˜„ ë°©ì‹ ëª…ì‹œ

**ëª…ì„¸ì„œ**: "blurë¡œ ëˆ„ì " ì–¸ê¸‰í•˜ë‚˜ êµ¬ì²´ì  ë°©ë²• ë¯¸ëª…ì‹œ

**ê°œì„  ì œì•ˆ**: Canvas `filter` ì‚¬ìš© vs ìˆ˜ë™ Gaussian blur ì„ íƒ ê¸°ì¤€ ì œì‹œ

```typescript
// ë°©ë²• 1: Canvas filter (ê°„ë‹¨, GPU ê°€ì†)
ctx.filter = 'blur(25px)';

// ë°©ë²• 2: ìˆ˜ë™ Gaussian blur (ë³µì¡, ëª¨ë“  ë¸Œë¼ìš°ì € í˜¸í™˜)
// êµ¬í˜„ ë³µì¡ë„ ë†’ìŒ
```

**ê¶Œì¥**: Canvas `filter` ì‚¬ìš© (ëª¨ë˜ ë¸Œë¼ìš°ì € ì§€ì›)

---

## 7. ìµœì¢… í‰ê°€ ë° ê¶Œì¥ì‚¬í•­

### âœ… 7.1 ëª…ì„¸ì„œ í’ˆì§ˆ í‰ê°€

**ì „ì²´ í‰ê°€**: â­â­â­â­â­ (5/5)

**ê°•ì **:
1. âœ… í˜„ì¬ êµ¬í˜„ ìƒíƒœ ì •í™•íˆ íŒŒì•…
2. âœ… ë¬¸ì œì  ëª…í™•íˆ ì§€ì  (ì¢Œí‘œ ì‹œìŠ¤í…œ, ë Œë”ë§ ë°©ì‹)
3. âœ… í•´ê²°ì±… êµ¬ì²´ì ì´ê³  ì‹¤í˜„ ê°€ëŠ¥
4. âœ… í•˜ìœ„ í˜¸í™˜ì„± ê³ ë ¤
5. âœ… ì„±ëŠ¥ ê°€ë“œ ì œì•ˆ
6. âœ… Non-goals ëª…í™•í™”

**ê°œì„  ê°€ëŠ¥í•œ ë¶€ë¶„**:
1. Blur êµ¬í˜„ ë°©ì‹ êµ¬ì²´í™” (Canvas filter vs ìˆ˜ë™)
2. ìƒ˜í”Œë§ ì „ëµ ìƒì„¸í™”
3. ì¢Œí‘œ ë³´ì • ë¡œì§ ì¶”ê°€ (ë™ì  ì½˜í…ì¸  ëŒ€ì‘)

---

### ğŸ¯ 7.2 êµ¬í˜„ ê¶Œì¥ì‚¬í•­

#### ì¦‰ì‹œ êµ¬í˜„ ê°€ëŠ¥ (P0)

1. âœ… **ì¢Œí‘œ ì‹œìŠ¤í…œ í™•ì¥** (Phase 1)
   - ë‚œì´ë„: ë‚®ìŒ
   - ì˜í–¥ë„: ë†’ìŒ (ê¸´ í˜ì´ì§€ì—ì„œ ìœ„ì¹˜ ì •í™•ë„ í–¥ìƒ)
   - ì˜ˆìƒ ì‹œê°„: 1-2ì‹œê°„

2. âœ… **ì„œë²„ ì§‘ê³„ ê³ í•´ìƒë„í™”** (Phase 2)
   - ë‚œì´ë„: ë‚®ìŒ
   - ì˜í–¥ë„: ì¤‘ê°„ (í•´ìƒë„ í–¥ìƒ)
   - ì˜ˆìƒ ì‹œê°„: 2-3ì‹œê°„

#### ë‹¨ê¸° êµ¬í˜„ ê¶Œì¥ (P1)

3. âœ… **ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤** (Phase 3)
   - ë‚œì´ë„: ë‚®ìŒ
   - ì˜í–¥ë„: ì¤‘ê°„ (ì„±ëŠ¥ í–¥ìƒ)
   - ì˜ˆìƒ ì‹œê°„: 2-3ì‹œê°„

#### ì¤‘ê¸° êµ¬í˜„ ê¶Œì¥ (P2)

4. âš ï¸ **Blob ë Œë”ë§ ì•Œê³ ë¦¬ì¦˜** (Phase 4)
   - ë‚œì´ë„: ì¤‘ê°„
   - ì˜í–¥ë„: ë†’ìŒ (ì‹œê°ì  í’ˆì§ˆ í–¥ìƒ)
   - ì˜ˆìƒ ì‹œê°„: 4-6ì‹œê°„
   - **ì£¼ì˜**: Canvas API ìˆ™ë ¨ë„ í•„ìš”

---

### ğŸ“‹ 7.3 êµ¬í˜„ ìˆœì„œ ì œì•ˆ

**ê¶Œì¥ ìˆœì„œ**:
1. Phase 1 â†’ Phase 2 â†’ Phase 3 â†’ Phase 4 (ìˆœì°¨ì )
2. ë˜ëŠ” Phase 1 â†’ Phase 2 â†’ Phase 4 (Phase 3 ìƒëµ ê°€ëŠ¥)

**ì´ìœ **:
- Phase 1, 2ëŠ” í•„ìˆ˜ (ì¢Œí‘œ ì •í™•ë„, í•´ìƒë„)
- Phase 3ëŠ” ì„±ëŠ¥ ìµœì í™” (ì„ íƒì )
- Phase 4ëŠ” ì‹œê°ì  í’ˆì§ˆ (í•µì‹¬ ê¸°ëŠ¥)

**ìµœì†Œ êµ¬í˜„** (MVP+):
- Phase 1 + Phase 2ë§Œìœ¼ë¡œë„ í° ê°œì„  ê°€ëŠ¥
- Phase 4ëŠ” "Beusableê¸‰" ëª©í‘œ ë‹¬ì„±ì„ ìœ„í•´ í•„ìš”

---

## 8. ê²°ë¡ 

### âœ… ëª…ì„¸ì„œ ê²€í†  ê²°ê³¼

**ì „ì²´ í‰ê°€**: **ë§¤ìš° ìš°ìˆ˜í•œ ëª…ì„¸ì„œ**

1. âœ… ê¸°ìˆ ì  íƒ€ë‹¹ì„±: ëª¨ë“  ì œì•ˆì´ ì‹¤í˜„ ê°€ëŠ¥
2. âœ… í˜„ì¬ êµ¬í˜„ íŒŒì•…: ì •í™•íˆ ë¬¸ì œì  ì§€ì 
3. âœ… í•´ê²°ì±… êµ¬ì²´ì„±: ë‹¨ê³„ë³„ êµ¬í˜„ ê°€ì´ë“œ ì œê³µ
4. âœ… í˜¸í™˜ì„± ê³ ë ¤: í•˜ìœ„ í˜¸í™˜ì„± ìœ ì§€
5. âœ… ì„±ëŠ¥ ê³ ë ¤: ê°€ë“œ ë° ìµœì í™” ì œì•ˆ

### ğŸ¯ ê¶Œì¥ ì¡°ì¹˜

1. **ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥**: Phase 1, 2 êµ¬í˜„ (ì¢Œí‘œ í™•ì¥, ê³ í•´ìƒë„ ì§‘ê³„)
2. **ë‹¨ê¸° ëª©í‘œ**: Phase 3 êµ¬í˜„ (ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤)
3. **ì¤‘ê¸° ëª©í‘œ**: Phase 4 êµ¬í˜„ (Blob ë Œë”ë§)

### ğŸ’¡ ì¶”ê°€ ê³ ë ¤ì‚¬í•­

1. **Blur êµ¬í˜„ ë°©ì‹**: Canvas `filter` ì‚¬ìš© ê¶Œì¥ (ê°„ë‹¨, GPU ê°€ì†)
2. **ìƒ˜í”Œë§ ì „ëµ**: ì´ë²¤íŠ¸ ìˆ˜ê°€ ë§ì„ ë•Œ ìƒìœ„ Nê°œë§Œ ë Œë”ë§
3. **ë™ì  ì½˜í…ì¸  ëŒ€ì‘**: ì¢Œí‘œ ë³´ì • ë¡œì§ ì¶”ê°€ ê³ ë ¤

---

**ê²€í†  ì™„ë£Œì¼**: 2025-01-25  
**ê²€í† ì**: AI Assistant  
**ë‹¤ìŒ ë‹¨ê³„**: ì‚¬ìš©ì ìŠ¹ì¸ í›„ ë‹¨ê³„ë³„ êµ¬í˜„ ì§„í–‰

