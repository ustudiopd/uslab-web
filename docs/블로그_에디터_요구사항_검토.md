# [USLab] Novel.sh Editor ìš”êµ¬ì‚¬í•­ ê²€í†  ë³´ê³ ì„œ

**ê²€í†  ì¼ì**: 2025-01-03  
**í˜„ì¬ êµ¬í˜„ ìƒíƒœ**: Phase 2 (ê¸°ë³¸ ì—ë””í„° + ì´ë¯¸ì§€ ì—…ë¡œë“œ) ì™„ë£Œ  
**ëª©í‘œ**: Notion-like ë§ˆí¬ë‹¤ìš´ ì…ë ¥ + ì´ë¯¸ì§€ ì‚½ì… ì™„ì„±

---

## ğŸ“Š í˜„ì¬ êµ¬í˜„ ìƒíƒœ vs ìš”êµ¬ì‚¬í•­ ë¹„êµ

### âœ… **ì´ë¯¸ êµ¬í˜„ ì™„ë£Œëœ í•­ëª©**

#### 1. **ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¸í”„ë¼ (G3)**
- âœ… `/api/upload` API ë¼ìš°íŠ¸ êµ¬í˜„ ì™„ë£Œ
  - ì¸ì¦ í™•ì¸ (Bearer token)
  - íŒŒì¼ íƒ€ì…/í¬ê¸° ê²€ì¦ (10MB ì œí•œ)
  - Supabase Storage ì—…ë¡œë“œ (`uslab-images` ë²„í‚·)
  - Public URL ë°˜í™˜
- âœ… ì´ë¯¸ì§€ ì—…ë¡œë“œ í•¸ë“¤ëŸ¬ (`createImageUpload`, `handleImagePaste`, `handleImageDrop`)
- âœ… ë“œë˜ê·¸ ì•¤ ë“œë¡­ ì§€ì›
- âœ… í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸° (`Ctrl+V`) ì§€ì›
- âœ… ì—…ë¡œë“œ ì¤‘ placeholder í‘œì‹œ (`UploadImagesPlugin`)

#### 2. **ê¸°ë³¸ ì—ë””í„° êµ¬ì„±**
- âœ… Novel.sh ì—ë””í„° í†µí•© (`EditorRoot`, `EditorContent`)
- âœ… StarterKit í™•ì¥ (ê¸°ë³¸ ë¸”ë¡ ì§€ì›)
- âœ… ë§ˆí¬ë‹¤ìš´ í™•ì¥ (`@tiptap/markdown`) ì¶”ê°€
- âœ… ì´ë¯¸ì§€ í™•ì¥ (`UpdatedImage`) í†µí•©

#### 3. **ì €ì¥ ëª¨ë¸**
- âœ… Tiptap JSON ì €ì¥ (`uslab_posts.content` jsonb)
- âœ… DB ìŠ¤í‚¤ë§ˆ ë³€ê²½ ì—†ì´ ë™ì‘

---

### âš ï¸ **ë¶€ë¶„ êµ¬í˜„ / ê°œì„  í•„ìš” í•­ëª©**

#### 1. **ë§ˆí¬ë‹¤ìš´ ë‹¨ì¶• ì…ë ¥ (G1) - ë¶€ë¶„ êµ¬í˜„**

**í˜„ì¬ ìƒíƒœ:**
- âœ… StarterKit ê¸°ë³¸ ì œê³µ:
  - `# ` â†’ Heading 1
  - `## ` â†’ Heading 2
  - `### ` â†’ Heading 3
  - `- ` / `* ` â†’ Bullet list
  - `1. ` â†’ Ordered list
  - `> ` â†’ Blockquote
  - `` `code` `` â†’ Inline code
  - `**bold**`, `*italic*` â†’ ì¸ë¼ì¸ ë§ˆí¬

**ëˆ„ë½ëœ í•­ëª©:**
- âŒ `---` + Enter â†’ HorizontalRule (HR í™•ì¥ í•„ìš”)
- âŒ `- [ ]` / `- [x]` â†’ TaskList (TaskList/TaskItem í™•ì¥ í•„ìš”)
- âŒ Triple backtick (```) ì½”ë“œë¸”ëŸ­ ë‹¨ì¶• ì…ë ¥ (ìŠ¬ë˜ì‹œ ë©”ë‰´ë¡œëŠ” ê°€ëŠ¥í•˜ì§€ë§Œ ë‹¨ì¶• ì…ë ¥ ë¯¸ì§€ì›)

**í•„ìš” ì‘ì—…:**
```typescript
// í•„ìš”í•œ íŒ¨í‚¤ì§€ ì„¤ì¹˜
npm install @tiptap/extension-task-list @tiptap/extension-task-item @tiptap/extension-horizontal-rule

// í™•ì¥ ì¶”ê°€
import { TaskList } from '@tiptap/extension-task-list';
import { TaskItem } from '@tiptap/extension-task-item';
import { HorizontalRule } from '@tiptap/extension-horizontal-rule';
```

#### 2. **Markdown Import/Export (G2) - ë¯¸êµ¬í˜„**

**ìš”êµ¬ì‚¬í•­:**
- âŒ "Import .md" ë²„íŠ¼ ë° íŒŒì¼ ì„ íƒ ê¸°ëŠ¥
- âŒ ë§ˆí¬ë‹¤ìš´ í…ìŠ¤íŠ¸ ë¶™ì—¬ë„£ê¸° ê°ì§€ ë° ë³€í™˜
- âŒ "Copy as Markdown" / "Download .md" ê¸°ëŠ¥

**í•„ìš” ì‘ì—…:**
- `lib/utils/markdown.ts`: Markdown â†” Tiptap JSON ë³€í™˜ ìœ í‹¸
- Write/Edit í˜ì´ì§€ì— Import/Export ë²„íŠ¼ ì¶”ê°€
- FileReader APIë¡œ `.md` íŒŒì¼ ì½ê¸°
- `editor.storage.markdown.getMarkdown()` ë˜ëŠ” `@tiptap/markdown`ì˜ `generateMarkdown()` ì‚¬ìš©

#### 3. **ì´ë¯¸ì§€ ì‚½ì… UX (G3) - ë¶€ë¶„ êµ¬í˜„**

**í˜„ì¬ ìƒíƒœ:**
- âœ… ë“œë˜ê·¸ ì•¤ ë“œë¡­
- âœ… í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸°
- âœ… ì—…ë¡œë“œ ì¤‘ placeholder

**ëˆ„ë½ëœ í•­ëª©:**
- âŒ íˆ´ë°” "ì´ë¯¸ì§€ ì‚½ì…" ë²„íŠ¼
- âŒ ìŠ¬ë˜ì‹œ ë©”ë‰´ (`/image` ë˜ëŠ” `/img`) ì˜µì…˜
- âŒ URL ë¶™ì—¬ë„£ê¸°ë¡œ ì´ë¯¸ì§€ ì‚½ì… (ì„ íƒ)
- âŒ ìº¡ì…˜ ì§€ì› (figure/figcaption)
- âŒ "ëŒ€í‘œ ì´ë¯¸ì§€ë¡œ ì„¤ì •" ì•¡ì…˜

**í•„ìš” ì‘ì—…:**
- Novel.shì˜ ìŠ¬ë˜ì‹œ ë©”ë‰´ ì»¤ìŠ¤í„°ë§ˆì´ì§• (`createSuggestionItems`)
- íˆ´ë°” ë²„íŠ¼ ì¶”ê°€ (ë˜ëŠ” Novel.sh ê¸°ë³¸ íˆ´ë°” í™œìš©)
- URL ê°ì§€ ë° ì´ë¯¸ì§€ ë³€í™˜ ë¡œì§

#### 4. **ì—ë””í„° ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬ (3.2) - ë¯¸êµ¬í˜„**

**í˜„ì¬ ìƒíƒœ:**
- âŒ `components/editor/BlogEditor.tsx` ì—†ìŒ
- âŒ Write/Edit í˜ì´ì§€ì— ì—ë””í„° ë¡œì§ì´ ì§ì ‘ í¬í•¨ë¨

**í•„ìš” ì‘ì—…:**
- `BlogEditor.tsx` ì»´í¬ë„ŒíŠ¸ ìƒì„±
- Extension ì„¸íŠ¸ ì¤‘ì•™ ê´€ë¦¬
- Paste/drop ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ í†µí•©
- Props: `initialContent`, `onChange`, `onSetThumbnail?`

#### 5. **PostViewer ì´ë¯¸ì§€ ë Œë”ë§ (3.6) - í™•ì¸ í•„ìš”**

**í˜„ì¬ ìƒíƒœ:**
- âš ï¸ `PostViewer`ì—ì„œ `StarterKit`ë§Œ ì‚¬ìš©
- âš ï¸ `UpdatedImage` í™•ì¥ì´ í¬í•¨ë˜ì§€ ì•ŠìŒ

**ë¬¸ì œì :**
- ì´ë¯¸ì§€ ë…¸ë“œê°€ í¬í•¨ëœ JSONì„ ë Œë”ë§í•  ë•Œ ì´ë¯¸ì§€ê°€ í‘œì‹œë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŒ

**í•„ìš” ì‘ì—…:**
```typescript
// PostViewer.tsx ìˆ˜ì •
import { Image } from '@tiptap/extension-image';
// ë˜ëŠ” Novelì˜ UpdatedImage ì‚¬ìš©

return generateHTML(post.content, [
  StarterKit,
  Image, // ë˜ëŠ” UpdatedImage
]);
```

---

## ğŸ”§ êµ¬í˜„ ìš°ì„ ìˆœìœ„ ì œì•ˆ

### **Phase 1: í•„ìˆ˜ ê¸°ëŠ¥ ì™„ì„± (ì¦‰ì‹œ êµ¬í˜„)**
1. **TaskList/TaskItem í™•ì¥ ì¶”ê°€** (ë§ˆí¬ë‹¤ìš´ ë‹¨ì¶• ì…ë ¥ ì™„ì„±)
2. **HorizontalRule í™•ì¥ ì¶”ê°€** (`---` ë‹¨ì¶• ì…ë ¥)
3. **PostViewer ì´ë¯¸ì§€ ë Œë”ë§ ìˆ˜ì •** (ì´ë¯¸ì§€ ë…¸ë“œ ì§€ì›)

**ì˜ˆìƒ ì‹œê°„**: 30ë¶„

### **Phase 2: UX ê°œì„  (ë‹¨ê¸°)**
4. **ì—ë””í„° ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬** (`BlogEditor.tsx`)
5. **ìŠ¬ë˜ì‹œ ë©”ë‰´ì— ì´ë¯¸ì§€ ì‚½ì… ì¶”ê°€**
6. **íˆ´ë°” ì´ë¯¸ì§€ ì‚½ì… ë²„íŠ¼** (ë˜ëŠ” Novel ê¸°ë³¸ íˆ´ë°” í™œìš©)

**ì˜ˆìƒ ì‹œê°„**: 1-2ì‹œê°„

### **Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (ì¤‘ê¸°)**
7. **Markdown Import/Export UI**
8. **ì´ë¯¸ì§€ ìº¡ì…˜ ì§€ì›**
9. **URL ë¶™ì—¬ë„£ê¸° ì´ë¯¸ì§€ ì‚½ì…**
10. **"ëŒ€í‘œ ì´ë¯¸ì§€ë¡œ ì„¤ì •" ì•¡ì…˜**

**ì˜ˆìƒ ì‹œê°„**: 2-3ì‹œê°„

---

## ğŸ“ ì„¸ë¶€ êµ¬í˜„ ê°€ì´ë“œ

### 1. TaskList/TaskItem í™•ì¥ ì¶”ê°€

```typescript
// app/admin/posts/write/page.tsx
import { TaskList } from '@tiptap/extension-task-list';
import { TaskItem } from '@tiptap/extension-task-item';

// extensions ë°°ì—´ì— ì¶”ê°€
extensions={[
  StarterKit,
  Markdown as any,
  imageExtension,
  TaskList,
  TaskItem,
]}
```

**ì£¼ì˜**: Novel.shê°€ ì´ë¯¸ TaskList/TaskItemì„ ì œê³µí•  ìˆ˜ ìˆìœ¼ë¯€ë¡œ í™•ì¸ í•„ìš”:
```typescript
import { TaskList, TaskItem } from 'novel';
```

### 2. HorizontalRule í™•ì¥ ì¶”ê°€

```typescript
import { HorizontalRule } from '@tiptap/extension-horizontal-rule';
// ë˜ëŠ” Novelì˜ HorizontalRule ì‚¬ìš©
import { HorizontalRule as Horizontal } from 'novel';
```

### 3. PostViewer ì´ë¯¸ì§€ ë Œë”ë§ ìˆ˜ì •

```typescript
// components/blog/PostViewer.tsx
import { Image } from '@tiptap/extension-image';
// ë˜ëŠ”
import { UpdatedImage } from 'novel';

const htmlContent = useMemo(() => {
  return generateHTML(post.content, [
    StarterKit,
    Image, // ë˜ëŠ” UpdatedImage
  ]);
}, [post.content]);
```

### 4. Markdown Import/Export êµ¬í˜„

```typescript
// lib/utils/markdown.ts
import { generateMarkdown } from '@tiptap/markdown';
import { generateJSON } from '@tiptap/markdown';
import { Markdown } from '@tiptap/markdown';
import StarterKit from '@tiptap/starter-kit';

export function markdownToJSON(markdown: string): JSONContent {
  return generateJSON(markdown, [StarterKit, Markdown]);
}

export function jsonToMarkdown(json: JSONContent): string {
  return generateMarkdown(json, [StarterKit, Markdown]);
}
```

### 5. ìŠ¬ë˜ì‹œ ë©”ë‰´ ì»¤ìŠ¤í„°ë§ˆì´ì§•

```typescript
// Novel.shì˜ createSuggestionItems ì‚¬ìš©
import { createSuggestionItems } from 'novel';
import { ImageIcon } from 'lucide-react';

const suggestionItems = createSuggestionItems([
  // ... ê¸°ì¡´ í•­ëª©ë“¤
  {
    title: 'Image',
    description: 'Upload an image',
    searchTerms: ['image', 'img', 'picture', 'photo'],
    icon: <ImageIcon size={18} />,
    command: ({ editor, range }) => {
      // íŒŒì¼ ì„ íƒ ë¡œì§
      const input = document.createElement('input');
      input.type = 'file';
      input.accept = 'image/*';
      input.onchange = async (e) => {
        const file = (e.target as HTMLInputElement).files?.[0];
        if (file) {
          const url = await uploadFn(file, editor.view, editor.state.selection.from);
          editor.chain().focus().deleteRange(range).setImage({ src: url }).run();
        }
      };
      input.click();
    },
  },
]);
```

---

## âœ… Acceptance Criteria ì²´í¬ë¦¬ìŠ¤íŠ¸

### G1. ë§ˆí¬ë‹¤ìš´ ë‹¨ì¶• ì…ë ¥
- [x] `# `, `## `, `### ` â†’ Heading ë³€í™˜
- [x] `- `, `* ` â†’ Bullet list
- [x] `1. ` â†’ Ordered list
- [x] `> ` â†’ Blockquote
- [ ] `---` + Enter â†’ HorizontalRule âš ï¸ **ëˆ„ë½**
- [ ] `- [ ]`, `- [x]` â†’ TaskList âš ï¸ **ëˆ„ë½**
- [x] `**bold**`, `*italic*`, `` `code` `` â†’ ì¸ë¼ì¸ ë§ˆí¬

### G2. Markdown Import/Export
- [ ] .md íŒŒì¼ Import âš ï¸ **ë¯¸êµ¬í˜„**
- [ ] ë§ˆí¬ë‹¤ìš´ ë¶™ì—¬ë„£ê¸° ê°ì§€ âš ï¸ **ë¯¸êµ¬í˜„**
- [ ] Markdown Export (ë³µì‚¬/ë‹¤ìš´ë¡œë“œ) âš ï¸ **ë¯¸êµ¬í˜„**

### G3. Image Insert
- [x] ë“œë˜ê·¸ ì•¤ ë“œë¡­
- [x] í´ë¦½ë³´ë“œ ë¶™ì—¬ë„£ê¸° (`Ctrl+V`)
- [x] ì—…ë¡œë“œ ì¤‘ placeholder
- [ ] íˆ´ë°” ë²„íŠ¼ âš ï¸ **ëˆ„ë½**
- [ ] ìŠ¬ë˜ì‹œ ë©”ë‰´ (`/image`) âš ï¸ **ëˆ„ë½**
- [ ] URL ë¶™ì—¬ë„£ê¸° (ì„ íƒ) âš ï¸ **ëˆ„ë½**
- [ ] ìº¡ì…˜ ì§€ì› (ì„ íƒ) âš ï¸ **ëˆ„ë½**

### ë³´ì•ˆ ë° ì €ì¥
- [x] `/api/upload` ì¸ì¦ í™•ì¸ (401)
- [x] Tiptap JSON ì €ì¥ ëª¨ë¸ ìœ ì§€
- [ ] PostViewer ì´ë¯¸ì§€ ë Œë”ë§ í™•ì¸ âš ï¸ **í™•ì¸ í•„ìš”**

---

## ğŸ¯ ì¦‰ì‹œ ì‹¤í–‰ ê°€ëŠ¥í•œ ì‘ì—…

**ìµœìš°ì„  (30ë¶„ ë‚´ ì™„ë£Œ ê°€ëŠ¥):**
1. TaskList/TaskItem í™•ì¥ ì¶”ê°€
2. HorizontalRule í™•ì¥ ì¶”ê°€
3. PostViewerì— Image í™•ì¥ í¬í•¨

**ë‹¤ìŒ ë‹¨ê³„ (1-2ì‹œê°„):**
4. ì—ë””í„° ì»´í¬ë„ŒíŠ¸ ë¶„ë¦¬
5. ìŠ¬ë˜ì‹œ ë©”ë‰´ ì´ë¯¸ì§€ ì‚½ì… ì¶”ê°€

**ë‚˜ì¤‘ì— (2-3ì‹œê°„):**
6. Markdown Import/Export UI
7. ê³ ê¸‰ ì´ë¯¸ì§€ ê¸°ëŠ¥ (ìº¡ì…˜, URL ì‚½ì… ë“±)

---

## ğŸ“Œ ê²°ë¡ 

**í˜„ì¬ ì™„ì„±ë„**: ì•½ **70%**

**í•µì‹¬ ì¸í”„ë¼ëŠ” ì™„ë£Œë˜ì—ˆê³ **, ë‹¤ìŒ ë‹¨ê³„ëŠ”:
1. **ë§ˆí¬ë‹¤ìš´ ë‹¨ì¶• ì…ë ¥ ì™„ì„±** (TaskList, HR)
2. **PostViewer ì´ë¯¸ì§€ ë Œë”ë§ ë³´ì™„**
3. **UX ê°œì„ ** (ìŠ¬ë˜ì‹œ ë©”ë‰´, ì—ë””í„° ë¶„ë¦¬)
4. **Markdown Import/Export** (ì„ íƒ ê¸°ëŠ¥)

**ì¦‰ì‹œ ì‹œì‘ ê°€ëŠ¥í•œ ì‘ì—…ë¶€í„° ìˆœì°¨ì ìœ¼ë¡œ ì§„í–‰í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤.**





