# 운영진 보드 구현 명세서 검토 보고서

**작성일**: 2025-01-15  
**검토 대상**: `운영진보드구현.md` v1.0  
**검토자**: AI Assistant

---

## 📋 검토 개요

운영진 보드(Executive Board) 전체 명세서 v1.0을 검토하여, 현재 시스템과의 호환성, 구현 가능성, 개선점을 분석했습니다.

---

## ✅ 명세서의 강점

### 1. 요구사항 명확성
- ✅ 확정 요구사항이 명확히 정의됨 (보안, 권한, UX, 정렬 규칙)
- ✅ 핵심 개념 정의가 명확함 (Board, Doc, Priority, Top Highlight)
- ✅ 기존 명세와의 차이점이 명시됨 (핀 제거, 발행 개념 제거)

### 2. 데이터 모델 설계
- ✅ `uslab_` prefix 일관성 유지
- ✅ Soft delete 정책 명확 (휴지통)
- ✅ Priority 재계산 방식이 단순하고 명확
- ✅ 버전 관리 테이블 구조가 합리적

### 3. 보안 정책
- ✅ RLS 정책이 엄격함 (0% 공개 목표)
- ✅ `uslab_is_admin()` 함수 활용
- ✅ 운영진 화이트리스트 테이블 (`uslab_admins`) 제안

### 4. API 설계
- ✅ RESTful API 구조가 명확
- ✅ 자동저장 엔드포인트 명시 (`PATCH /api/admin/exec-docs/[id]`)
- ✅ 정렬 API가 단순하고 효율적

---

## ⚠️ 검토 사항 및 개선 제안

### 1. 현재 시스템과의 통합

#### 🔴 중요: 대시보드 탭 구조 변경 필요

**현재 상태**:
- `/admin/dashboard`는 단일 페이지로 구현됨
- AdminLayout에 상단 탭 네비게이션이 있음 (대시보드, 포스트 관리, 소개 페이지)

**명세서 요구사항**:
- `/admin/dashboard` 내부에 서브탭 필요:
  - `대시보드` (기존 KPI/통계)
  - `운영진 보드` (신규)

**제안**:
```typescript
// app/admin/dashboard/page.tsx 구조 변경 필요
// 현재: 단일 페이지
// 변경: 탭 기반 구조
const [activeTab, setActiveTab] = useState<'dashboard' | 'exec-board'>('dashboard');

// 또는 URL 쿼리 파라미터 사용
// /admin/dashboard?tab=dashboard
// /admin/dashboard?tab=exec-board
```

**권장**: URL 쿼리 파라미터 방식 (딥링크 지원)

---

### 2. 권한 관리 시스템

#### ⚠️ `uslab_admins` 테이블 존재 여부 확인 필요

**현재 상태**:
- `uslab_admins` 테이블이 마이그레이션에 없음
- 현재는 Supabase Auth의 `auth.users`만 사용

**명세서 요구사항**:
- `uslab_is_admin()` 함수가 `uslab_admins` 테이블을 참조
- RLS 정책이 이 함수를 사용

**제안**:
1. **옵션 A**: `uslab_admins` 테이블 생성 (명세서대로)
   - 장점: 명시적 운영진 관리, 확장성
   - 단점: 초기 운영진 등록 필요

2. **옵션 B**: 기존 인증 시스템 활용
   - 현재 모든 `auth.users`를 운영진으로 간주
   - 또는 특정 이메일 도메인으로 필터링

**권장**: 옵션 A (명세서대로) - 보안상 명시적 관리가 안전

---

### 3. 동시편집 구현 복잡도

#### ⚠️ 기술 스택 선택 필요

**명세서 요구사항**:
- 2~3명 동시 편집
- 실시간 반영 (1~2초 내)
- Presence 표시

**현재 Novel/Tiptap 상태**:
- Novel.sh는 기본적으로 단일 사용자 에디터
- 동시편집을 위해서는 추가 라이브러리 필요

**제안**:
1. **옵션 A**: Yjs + Tiptap Collab Provider
   - 장점: 실시간 동기화, 충돌 해결 자동
   - 단점: Supabase Realtime 또는 별도 서버 필요

2. **옵션 B**: 폴링 기반 간단한 동시편집
   - 2~3초마다 서버에서 최신 content 가져오기
   - 장점: 구현 단순, Supabase만으로 가능
   - 단점: 실시간성 낮음

3. **옵션 C**: MVP에서는 동시편집 제외
   - 자동저장만 구현
   - 동시편집은 Phase 2로

**권장**: 옵션 C (MVP) → 옵션 B (Phase 2) → 옵션 A (Phase 3)

---

### 4. 자동저장 구현

#### ✅ 현재 시스템과 호환 가능

**명세서 요구사항**:
- debounce 1~2초
- 로컬 스토리지 백업
- 저장 상태 표시

**현재 Novel 에디터**:
- `onUpdate` 콜백 제공
- `onChange` prop으로 변경 감지 가능

**제안**:
```typescript
// lib/hooks/useAutoSave.ts (신규 생성)
const useAutoSave = (docId: string, content: JSONContent) => {
  const [saveStatus, setSaveStatus] = useState<'saved' | 'saving' | 'error' | 'offline'>('saved');
  
  // debounce 로직
  // localStorage 백업
  // 서버 저장
};
```

---

### 5. 드래그 앤 드롭 정렬

#### ⚠️ 라이브러리 선택 필요

**명세서 요구사항**:
- 드래그로만 순서 변경
- 드래그 완료 후 즉시 저장

**제안**:
- **옵션 A**: `@dnd-kit/core` (권장)
  - React 19 호환
  - 접근성 지원
  - 가벼움

- **옵션 B**: `react-beautiful-dnd`
  - 널리 사용되지만 React 18+ 호환성 이슈 가능

**권장**: `@dnd-kit/core`

---

### 6. 히스토리/버전 관리

#### ✅ 블로그 시스템과 유사한 패턴

**현재 시스템**:
- `uslab_post_versions` 테이블 존재
- 버전 관리 패턴이 이미 구현됨

**명세서 요구사항**:
- `uslab_exec_doc_versions` 테이블
- `change_type` 구분 (auto_snapshot, manual_snapshot, restore_point)

**제안**:
- 블로그 버전 관리 코드를 참고하여 구현
- 자동 스냅샷 로직은 클라이언트에서 타이머로 구현

---

### 7. 텍스트 추출 유틸리티

#### ⚠️ 구현 필요

**명세서 요구사항**:
- 본문 요약 추출 (첫 100~150자)
- Tiptap JSON에서 텍스트 추출

**제안**:
```typescript
// lib/utils/extractText.ts (신규 생성)
import { generateHTML } from '@tiptap/html';
import { generateJSON } from '@tiptap/html';
import StarterKit from '@tiptap/starter-kit';

export function extractTextFromTiptap(content: JSONContent, maxLength: number = 150): string {
  // Tiptap JSON → HTML → 텍스트 추출
  // HTML 태그 제거
  // 첫 N자 반환
}
```

---

## 🔧 기술적 제약사항 고려

### 1. Vercel Pro 제약
- ✅ 함수 타임아웃 60초: 자동저장은 짧은 요청이므로 문제 없음
- ⚠️ 동시편집: Supabase Realtime 사용 시 추가 비용 고려

### 2. Supabase 공유 프로젝트
- ✅ `uslab_` prefix 일관성 유지
- ✅ RLS 정책이 다른 프로젝트와 충돌하지 않음

### 3. Novel.sh 에디터
- ✅ Tiptap 기반이므로 확장 가능
- ⚠️ 동시편집은 추가 라이브러리 필요

---

## 📝 구현 우선순위 제안

### Phase 1: MVP (핵심 기능)
1. ✅ DB 마이그레이션 (테이블, RLS, 트리거)
2. ✅ API 엔드포인트 (Boards, Docs 기본 CRUD)
3. ✅ 대시보드 탭 구조 변경
4. ✅ 운영진 보드 탭 UI (리스트, 편집기)
5. ✅ 자동저장 (debounce + 상태 표시)
6. ✅ 드래그 정렬 (dnd-kit)
7. ✅ 휴지통 (soft delete)

### Phase 2: 고급 기능
8. ⚠️ 동시편집 (폴링 기반 또는 Yjs)
9. ⚠️ 히스토리 UI (슬라이드오버)
10. ⚠️ 자동 스냅샷 (10분 간격)

### Phase 3: 최적화
11. ⚠️ 실시간 동시편집 (Yjs + Supabase Realtime)
12. ⚠️ 정렬 소프트 락 (TTL 기반)

---

## 🎯 명세서 완성도 평가

### ✅ 잘 정의된 부분
- 요구사항 명확성: **9/10**
- 데이터 모델 설계: **9/10**
- API 명세: **8/10**
- 보안 정책: **9/10**

### ⚠️ 보완 필요한 부분
- 동시편집 기술 스택: **5/10** (구체적 라이브러리 미명시)
- 자동저장 구현 세부사항: **6/10** (로컬 백업 전략 미명시)
- 에러 처리 전략: **5/10** (충돌 해결 방법 미명시)

---

## 💡 추가 제안사항

### 1. 초기 데이터 (Seed)
```sql
-- 기본 보드 생성
INSERT INTO uslab_exec_boards (name, description, sort_order)
VALUES 
  ('공지', '운영진 공지사항', 0),
  ('회의록', '주간 회의 기록', 1),
  ('의사결정', '중요 의사결정 로그', 2);
```

### 2. 운영진 등록 스크립트
```typescript
// scripts/add-admin.ts
// 특정 사용자를 uslab_admins에 추가
```

### 3. 마이그레이션 파일명
```
supabase/migrations/20250115_create_uslab_exec_boards.sql
```

---

## ✅ 최종 평가

### 명세서 품질: **8.5/10**

**강점**:
- 요구사항이 명확하고 구체적
- 현재 시스템과의 호환성 고려
- 보안 정책이 엄격하고 안전

**개선점**:
- 동시편집 기술 스택 구체화 필요
- 자동저장 구현 세부사항 보완
- 에러 처리/충돌 해결 전략 추가

### 구현 가능성: **높음** ✅

현재 기술 스택(Next.js 14, Supabase, Novel.sh)으로 모든 기능 구현 가능. 동시편집은 MVP에서는 제외하거나 간단한 폴링 방식으로 시작하는 것을 권장.

---

## 🚀 다음 단계

명세서를 기준으로 구현을 시작할 수 있습니다. 필요하시면:
1. **구현 TODO 리스트** 생성 (작업 순서, 파일 구조, 컴포넌트 체크리스트)
2. **마이그레이션 파일** 생성
3. **타입 정의 파일** 생성
4. **API 라우트 스켈레톤** 생성

원하시면 바로 진행하겠습니다.

