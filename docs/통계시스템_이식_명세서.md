# í†µê³„ ì‹œìŠ¤í…œ ì´ì‹ ëª…ì„¸ì„œ

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì•„í‚¤í…ì²˜](#2-ì•„í‚¤í…ì²˜)
3. [ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ](#3-ë°ì´í„°ë² ì´ìŠ¤-ìŠ¤í‚¤ë§ˆ)
4. [í™˜ê²½ ì„¤ì •](#4-í™˜ê²½-ì„¤ì •)
5. [í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ êµ¬í˜„](#5-í´ë¼ì´ì–¸íŠ¸-ì‚¬ì´ë“œ-êµ¬í˜„)
6. [ì„œë²„ ì‚¬ì´ë“œ êµ¬í˜„](#6-ì„œë²„-ì‚¬ì´ë“œ-êµ¬í˜„)
7. [ëŒ€ì‹œë³´ë“œ êµ¬í˜„](#7-ëŒ€ì‹œë³´ë“œ-êµ¬í˜„)
8. [íˆíŠ¸ë§µ ê¸°ëŠ¥](#8-íˆíŠ¸ë§µ-ê¸°ëŠ¥)
9. [AI ë³´ê³ ì„œ ê¸°ëŠ¥](#9-ai-ë³´ê³ ì„œ-ê¸°ëŠ¥)
10. [ì´ì‹ ê°€ì´ë“œ](#10-ì´ì‹-ê°€ì´ë“œ)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### 1.1 ê¸°ëŠ¥ ëª©ë¡

- âœ… **ì„¸ì…˜ ì¶”ì **: 30ë¶„ ë¹„í™œì„± ê¸°ì¤€ ì„¸ì…˜ ê´€ë¦¬
- âœ… **í˜ì´ì§€ë·° ì¶”ì **: ë¼ìš°íŠ¸ ë³€ê²½ ì‹œ ìë™ í˜ì´ì§€ë·° ê¸°ë¡
- âœ… **ì´ë²¤íŠ¸ ì¶”ì **: í´ë¦­, ìŠ¤í¬ë¡¤, ì „í™˜, í˜ì´ì§€ ì°¸ì—¬ë„, Web Vitals
- âœ… **íˆíŠ¸ë§µ**: í´ë¦­ ì¢Œí‘œ ê¸°ë°˜ ì‹œê°ì  íˆíŠ¸ë§µ
- âœ… **ëŒ€ì‹œë³´ë“œ**: ì‹¤ì‹œê°„ í†µê³„ ë° íŠ¸ë Œë“œ ë¶„ì„
- âœ… **AI ë³´ê³ ì„œ**: AI ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ìë™ ìƒì„±
- âœ… **ë©€í‹°í…Œë„ŒíŠ¸**: Prefix ê¸°ë°˜ ë°ì´í„° ë¶„ë¦¬ (uslab, ustudio, modu ë“±)

### 1.2 ê¸°ìˆ  ìŠ¤íƒ

- **í”„ë¡ íŠ¸ì—”ë“œ**: Next.js 14+ (App Router), React, TypeScript
- **ë°±ì—”ë“œ**: Next.js API Routes, Supabase (PostgreSQL)
- **ë°ì´í„°ë² ì´ìŠ¤**: PostgreSQL (Supabase)
- **ì°¨íŠ¸ ë¼ì´ë¸ŒëŸ¬ë¦¬**: Recharts
- **AI**: Google Gemini API
- **íŠ¸ë˜í‚¹**: HTML5 Canvas API (íˆíŠ¸ë§µ)

---

## 2. ì•„í‚¤í…ì²˜

### 2.1 ë°ì´í„° íë¦„

```
[í´ë¼ì´ì–¸íŠ¸]
  â†“
Tracker.tsx (ì„¸ì…˜/í˜ì´ì§€ë·° ê´€ë¦¬)
  â†“
eventTracker.ts (ì´ë²¤íŠ¸ í ê´€ë¦¬)
  â†“
WebVitals.tsx (ì„±ëŠ¥ ë©”íŠ¸ë¦­ ìˆ˜ì§‘)
  â†“
POST /api/track (ë°°ì¹˜ ì „ì†¡)
  â†“
[ì„œë²„]
  â†“
Bot í•„í„°ë§
  â†“
ì„¸ì…˜ Upsert
  â†“
í˜ì´ì§€ë·° Insert
  â†“
ì´ë²¤íŠ¸ Bulk Insert
  â†“
[ë°ì´í„°ë² ì´ìŠ¤]
  â†“
{{prefix}}_sessions
{{prefix}}_page_views
{{prefix}}_events
```

### 2.2 í•µì‹¬ ì„¤ê³„ ì›ì¹™

1. **Prefix ê¸°ë°˜ ë©€í‹°í…Œë„ŒíŠ¸**: ëª¨ë“  í…Œì´ë¸”ê³¼ ì„¤ì •ì´ prefixë¡œ ë¶„ë¦¬
2. **Fire-and-Forget**: ì‚¬ìš©ì ê²½í—˜ì— ì˜í–¥ ì—†ë„ë¡ ì—ëŸ¬ ì‹œì—ë„ 204 ë°˜í™˜
3. **ë°°ì¹˜ ì „ì†¡**: ì´ë²¤íŠ¸ë¥¼ íì— ëª¨ì•„ 5ì´ˆë§ˆë‹¤ ë˜ëŠ” 20ê°œ ì´ìƒì¼ ë•Œ ì „ì†¡
4. **Bot í•„í„°ë§**: User-Agent ê¸°ë°˜ ë´‡ íŠ¸ë˜í”½ ì œì™¸
5. **ìƒ˜í”Œë§ ì§€ì›**: ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ëŒ€ë¹„ ì´ë²¤íŠ¸ ìƒ˜í”Œë§ ê°€ëŠ¥

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ

### 3.1 í…Œì´ë¸” êµ¬ì¡°

#### 3.1.1 `{{prefix}}_sessions`

```sql
create table if not exists {{prefix}}_sessions (
  id uuid primary key default gen_random_uuid(),
  session_key text not null unique,
  
  -- Entry ì •ë³´
  landing_path text,
  referrer text,
  referrer_host text,
  
  -- UTM íŒŒë¼ë¯¸í„°
  utm_source text,
  utm_medium text,
  utm_campaign text,
  utm_term text,
  utm_content text,
  
  -- ë””ë°”ì´ìŠ¤/í™˜ê²½
  user_agent text,
  device_type text check (device_type in ('mobile', 'tablet', 'desktop', 'bot', 'unknown')),
  
  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at timestamptz not null default now(),
  last_seen_at timestamptz not null default now()
);

-- ì¸ë±ìŠ¤
create unique index {{prefix}}_idx_sessions_session_key on {{prefix}}_sessions (session_key);
create index {{prefix}}_idx_sessions_created_at on {{prefix}}_sessions (created_at desc);
create index {{prefix}}_idx_sessions_last_seen_at on {{prefix}}_sessions (last_seen_at desc);
create index {{prefix}}_idx_sessions_referrer_host on {{prefix}}_sessions (referrer_host);
create index {{prefix}}_idx_sessions_utm_campaign on {{prefix}}_sessions (utm_campaign);
```

#### 3.1.2 `{{prefix}}_page_views`

```sql
create table if not exists {{prefix}}_page_views (
  id uuid primary key,  -- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•œ UUID
  session_id uuid not null references {{prefix}}_sessions(id) on delete cascade,
  
  -- ì½˜í…ì¸  ë§¤í•‘ (ì˜µì…˜)
  post_id uuid,  -- ë„ë©”ì¸ë³„ FK (ì˜ˆ: uslab_posts)
  about_id uuid,  -- ë„ë©”ì¸ë³„ FK (ì˜ˆ: uslab_about)
  
  -- í˜ì´ì§€ ì •ë³´
  page_path text not null,
  locale text check (locale in ('ko', 'en')),
  
  -- í™•ì¥ ì»¬ëŸ¼
  view_duration integer,  -- ì´ˆ
  scroll_depth integer,   -- 0-100
  
  created_at timestamptz not null default now()
);

-- ì¸ë±ìŠ¤
create index {{prefix}}_idx_page_views_created_at on {{prefix}}_page_views (created_at desc);
create index {{prefix}}_idx_page_views_page_path_created_at on {{prefix}}_page_views (page_path, created_at desc);
create index {{prefix}}_idx_page_views_session_id_created_at on {{prefix}}_page_views (session_id, created_at desc);
create index {{prefix}}_idx_page_views_post_id_created_at on {{prefix}}_page_views (post_id, created_at desc) where post_id is not null;
```

#### 3.1.3 `{{prefix}}_events`

```sql
create table if not exists {{prefix}}_events (
  id uuid primary key,  -- í´ë¼ì´ì–¸íŠ¸ì—ì„œ ìƒì„±í•œ UUID
  session_id uuid not null references {{prefix}}_sessions(id) on delete cascade,
  page_view_id uuid references {{prefix}}_page_views(id) on delete set null,
  
  -- ì´ë²¤íŠ¸ ì •ë³´
  name varchar(100) not null,  -- click, scroll_depth, conversion, page_engagement, web_vital
  page_path text not null,
  
  -- ì´ë²¤íŠ¸ ì†ì„± (JSONB)
  props jsonb default '{}'::jsonb,
  
  -- íƒ€ì„ìŠ¤íƒ¬í”„
  client_ts bigint,  -- í´ë¼ì´ì–¸íŠ¸ íƒ€ì„ìŠ¤íƒ¬í”„ (ë°€ë¦¬ì´ˆ)
  created_at timestamptz not null default now()
);

-- ì¸ë±ìŠ¤
create index {{prefix}}_idx_events_created_at on {{prefix}}_events (created_at desc);
create index {{prefix}}_idx_events_session_id on {{prefix}}_events (session_id, created_at desc);
create index {{prefix}}_idx_events_page_view_id on {{prefix}}_events (page_view_id, created_at desc);
create index {{prefix}}_idx_events_name on {{prefix}}_events (name, created_at desc);
create index {{prefix}}_idx_events_page_path on {{prefix}}_events (page_path, created_at desc);

-- JSONB ì¸ë±ìŠ¤ (íˆíŠ¸ë§µ ì¿¼ë¦¬ ìµœì í™”)
create index {{prefix}}_idx_events_props_click on {{prefix}}_events 
  using gin (props jsonb_path_ops) 
  where name = 'click';
```

#### 3.1.4 `{{prefix}}_analytics_reports` (AI ë³´ê³ ì„œ)

```sql
create table if not exists {{prefix}}_analytics_reports (
  id uuid primary key default gen_random_uuid(),
  
  -- ë©€í‹°í…Œë„ŒíŠ¸ ì§€ì›
  site_prefix varchar(50) not null,
  
  -- ë³´ê³ ì„œ ë©”íƒ€ ì •ë³´
  report_type varchar(20) not null,  -- daily/weekly/monthly/custom
  period_start date not null,
  period_end date not null,
  days integer not null,
  include_comparison boolean default false,
  
  -- ìƒì„± ì •ë³´
  prompt_version varchar(20) not null,
  model_name varchar(50) not null,
  report_json jsonb not null,
  
  -- ìºì‹±ì„ ìœ„í•œ ì…ë ¥ í•´ì‹œ
  input_hash varchar(64) not null,
  
  -- ìƒì„± ë°©ì‹
  created_via varchar(20) not null,  -- manual/cron
  
  -- íƒ€ì„ìŠ¤íƒ¬í”„
  generated_at timestamptz not null default now(),
  created_at timestamptz not null default now()
);

-- ì¸ë±ìŠ¤
create index {{prefix}}_idx_reports_site_prefix on {{prefix}}_analytics_reports (site_prefix, generated_at desc);
create index {{prefix}}_idx_reports_input_hash on {{prefix}}_analytics_reports (input_hash);
```

#### 3.1.5 `{{prefix}}_analytics_report_comments` (AI ë³´ê³ ì„œ ëŒ“ê¸€)

```sql
create table if not exists {{prefix}}_analytics_report_comments (
  id uuid primary key default gen_random_uuid(),
  report_id uuid not null references {{prefix}}_analytics_reports(id) on delete cascade,
  
  -- ì‘ì„±ì ì •ë³´
  user_id uuid references auth.users(id) on delete set null,
  user_email text,
  author_name text not null,
  
  -- ëŒ“ê¸€ ë‚´ìš©
  content text not null,
  
  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at timestamptz not null default now(),
  updated_at timestamptz not null default now()
);

-- ì¸ë±ìŠ¤
create index {{prefix}}_idx_report_comments_report_id on {{prefix}}_analytics_report_comments (report_id, created_at desc);
create index {{prefix}}_idx_report_comments_user_id on {{prefix}}_analytics_report_comments (user_id);
```

### 3.2 RLS (Row Level Security) ì •ì±…

ëª¨ë“  í…Œì´ë¸”ì— ëŒ€í•´ `authenticated` ì‚¬ìš©ìë§Œ ì¡°íšŒ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •:

```sql
alter table {{prefix}}_sessions enable row level security;
alter table {{prefix}}_page_views enable row level security;
alter table {{prefix}}_events enable row level security;
alter table {{prefix}}_analytics_reports enable row level security;
alter table {{prefix}}_analytics_report_comments enable row level security;

-- ì¡°íšŒ ì •ì±…
create policy {{prefix}}_policy_sessions_select_authenticated
  on {{prefix}}_sessions for select
  using (auth.role() = 'authenticated');

create policy {{prefix}}_policy_page_views_select_authenticated
  on {{prefix}}_page_views for select
  using (auth.role() = 'authenticated');

create policy {{prefix}}_policy_events_select_authenticated
  on {{prefix}}_events for select
  using (auth.role() = 'authenticated');

create policy {{prefix}}_policy_reports_select_authenticated
  on {{prefix}}_analytics_reports for select
  using (auth.role() = 'authenticated');

create policy {{prefix}}_policy_report_comments_select_authenticated
  on {{prefix}}_analytics_report_comments for select
  using (auth.role() = 'authenticated');

-- ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ ì •ì±…
create policy {{prefix}}_policy_report_comments_insert_authenticated
  on {{prefix}}_analytics_report_comments for insert
  with check (auth.role() = 'authenticated');

create policy {{prefix}}_policy_report_comments_update_own
  on {{prefix}}_analytics_report_comments for update
  using (auth.uid() = user_id);

create policy {{prefix}}_policy_report_comments_delete_own
  on {{prefix}}_analytics_report_comments for delete
  using (auth.uid() = user_id);
```

### 3.3 ë°ì´í„° ì •ë¦¬ í•¨ìˆ˜

```sql
create or replace function {{prefix}}_cleanup_old_tracking()
returns integer
language plpgsql
security definer
as $$
declare
  deleted_pageviews integer;
  deleted_sessions integer;
begin
  -- 90ì¼ ì§€ë‚œ page_views ì‚­ì œ
  delete from {{prefix}}_page_views
  where created_at < now() - interval '90 days';
  
  get diagnostics deleted_pageviews = row_count;
  
  -- orphan sessions ì‚­ì œ
  delete from {{prefix}}_sessions s
  where s.created_at < now() - interval '90 days'
    and not exists (select 1 from {{prefix}}_page_views pv where pv.session_id = s.id);
  
  get diagnostics deleted_sessions = row_count;
  
  return deleted_pageviews + deleted_sessions;
end;
$$;

grant execute on function {{prefix}}_cleanup_old_tracking() to service_role;
```

---

## 4. í™˜ê²½ ì„¤ì •

### 4.1 í•„ìˆ˜ í™˜ê²½ ë³€ìˆ˜

```bash
# Analytics ì„¤ì •
ANALYTICS_PREFIX=uslab  # uslab, ustudio, modu ë“±
ANALYTICS_ENABLED=true
ANALYTICS_SAMPLE_RATE_EVENTS=1.0  # 0.0 ~ 1.0
ANALYTICS_SAMPLE_RATE_HEATMAP=1.0  # 0.0 ~ 1.0
ANALYTICS_EXCLUDE_PATH_PREFIXES=/admin,/api,/api  # ì‰¼í‘œë¡œ êµ¬ë¶„
ANALYTICS_RESPECT_DNT=true  # Do Not Track í—¤ë” ì¡´ì¤‘

# Supabase ì„¤ì •
NEXT_PUBLIC_SUPABASE_URL=https://xxx.supabase.co
NEXT_PUBLIC_SUPABASE_ANON_KEY=xxx
SUPABASE_SERVICE_ROLE_KEY=xxx  # ì„œë²„ ì‚¬ì´ë“œ ì „ìš©

# AI ë³´ê³ ì„œ (ì„ íƒ)
GOOGLE_GEMINI_API_KEY=xxx  # AI ë³´ê³ ì„œ ìƒì„±ìš©
```

### 4.2 ì„¤ì • íŒŒì¼: `lib/config/analytics.ts`

```typescript
/**
 * Analytics ì„¤ì •
 * í™˜ê²½ë³€ìˆ˜ë¥¼ í†µí•œ prefix ë° ì„¤ì • ê´€ë¦¬
 */

export const ANALYTICS_PREFIX =
  (process.env.ANALYTICS_PREFIX || 'uslab').toLowerCase();

export const ANALYTICS_ENABLED =
  process.env.ANALYTICS_ENABLED !== 'false';

export const ANALYTICS_SAMPLE_RATE_EVENTS = parseFloat(
  process.env.ANALYTICS_SAMPLE_RATE_EVENTS || '1.0'
);

export const ANALYTICS_SAMPLE_RATE_HEATMAP = parseFloat(
  process.env.ANALYTICS_SAMPLE_RATE_HEATMAP || '1.0'
);

export const ANALYTICS_EXCLUDE_PATH_PREFIXES = (
  process.env.ANALYTICS_EXCLUDE_PATH_PREFIXES ||
  '/admin,/api,/_next'
).split(',').map((p) => p.trim());

export const ANALYTICS_RESPECT_DNT =
  process.env.ANALYTICS_RESPECT_DNT !== 'false';

/**
 * í…Œì´ë¸” ì´ë¦„ ìƒì„± í—¬í¼
 */
export function getAnalyticsTableName(tableName: string): string {
  return `${ANALYTICS_PREFIX}_${tableName}`;
}

/**
 * localStorage ì„¸ì…˜ í‚¤ ì´ë¦„ ìƒì„±
 */
export function getSessionStorageKey(): string {
  return `${ANALYTICS_PREFIX}_sid`;
}

/**
 * localStorage ë§ˆì§€ë§‰ í™œë™ ì‹œê°„ í‚¤ ì´ë¦„ ìƒì„±
 */
export function getLastSeenStorageKey(): string {
  return `${ANALYTICS_PREFIX}_sid_last`;
}
```

---

## 5. í´ë¼ì´ì–¸íŠ¸ ì‚¬ì´ë“œ êµ¬í˜„

### 5.1 íŒŒì¼ êµ¬ì¡°

```
components/analytics/
  â”œâ”€â”€ Tracker.tsx          # ì„¸ì…˜/í˜ì´ì§€ë·° ê´€ë¦¬
  â””â”€â”€ WebVitals.tsx        # Web Vitals ìˆ˜ì§‘

lib/utils/
  â”œâ”€â”€ eventTracker.ts      # ì´ë²¤íŠ¸ í ê´€ë¦¬
  â””â”€â”€ tracking.ts          # UTM/Referrer íŒŒì‹± ìœ í‹¸ë¦¬í‹°
```

### 5.2 Tracker.tsx

**ì—­í• **: ì„¸ì…˜ ê´€ë¦¬ ë° í˜ì´ì§€ë·° ì¶”ì 

**ì£¼ìš” ê¸°ëŠ¥**:
- ì„¸ì…˜ í‚¤ ìƒì„±/ê°±ì‹  (30ë¶„ ë§Œë£Œ)
- í˜ì´ì§€ë·° ìë™ ì¶”ì  (ë¼ìš°íŠ¸ ë³€ê²½ ì‹œ)
- UTM íŒŒë¼ë¯¸í„° ë° Referrer ì¶”ì 
- Bot í•„í„°ë§
- Do Not Track í—¤ë” ì¡´ì¤‘

**ì‚¬ìš©ë²•**:
```tsx
// app/layout.tsx
import Tracker from '@/components/analytics/Tracker';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Suspense fallback={null}>
          <Tracker />
        </Suspense>
      </body>
    </html>
  );
}
```

### 5.3 eventTracker.ts

**ì—­í• **: ì´ë²¤íŠ¸ í ê´€ë¦¬ ë° ë°°ì¹˜ ì „ì†¡

**ì£¼ìš” ê¸°ëŠ¥**:
- ì´ë²¤íŠ¸ í ê´€ë¦¬ (ìµœëŒ€ 20ê°œ ë˜ëŠ” 5ì´ˆë§ˆë‹¤ ì „ì†¡)
- í´ë¦­ ì´ë²¤íŠ¸ ì¶”ì 
- ìŠ¤í¬ë¡¤ ê¹Šì´ ì¶”ì 
- ì „í™˜ ì´ë²¤íŠ¸ ì¶”ì 
- í˜ì´ì§€ ì°¸ì—¬ë„ ì¶”ì 
- ìƒ˜í”Œë§ ì§€ì›

**ì‚¬ìš©ë²•**:
```typescript
import { eventQueue, trackClick } from '@/lib/utils/eventTracker';

// í´ë¦­ ì´ë²¤íŠ¸ ì¶”ì 
window.addEventListener('click', (event) => {
  trackClick(event, pageViewId, pagePath);
});

// ì»¤ìŠ¤í…€ ì´ë²¤íŠ¸ ì¶”ê°€
eventQueue.add({
  name: 'conversion',
  page_view_id: pageViewId,
  page_path: pagePath,
  props: {
    conversion_type: 'signup',
    value: 100,
  },
});
```

### 5.4 WebVitals.tsx

**ì—­í• **: Web Vitals ë©”íŠ¸ë¦­ ìˆ˜ì§‘

**ì£¼ìš” ê¸°ëŠ¥**:
- LCP (Largest Contentful Paint)
- CLS (Cumulative Layout Shift)
- INP (Interaction to Next Paint)
- FCP (First Contentful Paint)
- TTFB (Time to First Byte)
- FID (First Input Delay)

**ì‚¬ìš©ë²•**:
```tsx
// app/layout.tsx
import WebVitals from '@/components/analytics/WebVitals';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Suspense fallback={null}>
          <WebVitals />
        </Suspense>
      </body>
    </html>
  );
}
```

---

## 6. ì„œë²„ ì‚¬ì´ë“œ êµ¬í˜„

### 6.1 íŒŒì¼ êµ¬ì¡°

```
app/api/
  â””â”€â”€ track/
      â””â”€â”€ route.ts         # íŠ¸ë˜í‚¹ API ì—”ë“œí¬ì¸íŠ¸

lib/queries/
  â””â”€â”€ analytics.ts         # ëŒ€ì‹œë³´ë“œ ì¿¼ë¦¬ í•¨ìˆ˜

lib/utils/
  â””â”€â”€ tracking.ts         # ì„œë²„ ì‚¬ì´ë“œ íŒŒì‹± ìœ í‹¸ë¦¬í‹°
```

### 6.2 POST /api/track

**ì—­í• **: í´ë¼ì´ì–¸íŠ¸ì—ì„œ ì „ì†¡ëœ íŠ¸ë˜í‚¹ ë°ì´í„°ë¥¼ ë°ì´í„°ë² ì´ìŠ¤ì— ì €ì¥

**ìš”ì²­ ìŠ¤í‚¤ë§ˆ (v2)**:
```typescript
{
  session_key: string;
  page_view?: {
    id: string;  // UUID
    page_path: string;
    locale?: 'ko' | 'en' | null;
    referrer?: string | null;
    utm?: {
      source?: string | null;
      medium?: string | null;
      campaign?: string | null;
      term?: string | null;
      content?: string | null;
    } | null;
  };
  post_id?: string | null;  // ì˜µì…˜: ë„ë©”ì¸ë³„ ì½˜í…ì¸  ë§¤í•‘
  about_id?: string | null;  // ì˜µì…˜: ë„ë©”ì¸ë³„ ì½˜í…ì¸  ë§¤í•‘
  events?: Array<{
    id: string;  // UUID
    name: string;  // click, scroll_depth, conversion, page_engagement, web_vital
    page_view_id?: string | null;
    page_path: string;
    props?: Record<string, any>;
    client_ts?: number | null;
  }>;
}
```

**ì²˜ë¦¬ íë¦„**:
1. Bot í•„í„°ë§ (User-Agent ê¸°ë°˜)
2. ì„¸ì…˜ Upsert (ì—†ìœ¼ë©´ ìƒì„±, ìˆìœ¼ë©´ `last_seen_at` ì—…ë°ì´íŠ¸, throttle: 3ë¶„)
3. í˜ì´ì§€ë·° Insert (í´ë¼ì´ì–¸íŠ¸ ìƒì„± ID ì‚¬ìš©)
4. ì´ë²¤íŠ¸ Bulk Insert
5. ì‘ë‹µ: 204 No Content (ì—ëŸ¬ ì‹œì—ë„ 204)

### 6.3 lib/queries/analytics.ts

**ì—­í• **: ëŒ€ì‹œë³´ë“œìš© ì§‘ê³„ ì¿¼ë¦¬ í•¨ìˆ˜

**ì£¼ìš” í•¨ìˆ˜**:
- `getTodayStats()`: ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜ ë° í˜ì´ì§€ë·°
- `getDailyStats(days)`: ì¼ë³„ í†µê³„ (í˜ì´ì§€ë·°, ê³ ìœ  ë°©ë¬¸ì)
- `getDailyStatsByRange(startDate, endDate)`: ê¸°ê°„ë³„ ì¼ë³„ í†µê³„
- `getTopPages(days, limit)`: ì¸ê¸° í˜ì´ì§€
- `getTopPosts(days, limit)`: ì¸ê¸° í¬ìŠ¤íŠ¸ (ë„ë©”ì¸ë³„)
- `getTopReferrers(days, limit)`: ì¸ê¸° ìœ ì… ê²½ë¡œ
- `getTopClickedElements(days, limit)`: ì¸ê¸° í´ë¦­ ìš”ì†Œ
- `getPageClickStats(days, limit)`: í˜ì´ì§€ë³„ í´ë¦­ í†µê³„
- `getHeatmapGridData(pagePath, days, gridSize, deviceFilter)`: íˆíŠ¸ë§µ ê·¸ë¦¬ë“œ ë°ì´í„°
- `getWebVitalsStats(days)`: Web Vitals í†µê³„

**íŠ¹ì§•**:
- KST (í•œêµ­ ì‹œê°„) ê¸°ì¤€ ë‚ ì§œ ì²˜ë¦¬
- í˜ì´ì§€ë„¤ì´ì…˜ ì§€ì› (Supabase 1000í–‰ ì œí•œ ëŒ€ì‘)
- Prefix ê¸°ë°˜ í…Œì´ë¸” ì´ë¦„ ë™ì  ìƒì„±

---

## 7. ëŒ€ì‹œë³´ë“œ êµ¬í˜„

### 7.1 íŒŒì¼ êµ¬ì¡°

```
app/admin/
  â””â”€â”€ dashboard/
      â””â”€â”€ page.tsx         # ëŒ€ì‹œë³´ë“œ UI

app/api/admin/
  â””â”€â”€ dashboard/
      â””â”€â”€ route.ts         # ëŒ€ì‹œë³´ë“œ ë°ì´í„° API
```

### 7.2 ëŒ€ì‹œë³´ë“œ ê¸°ëŠ¥

- **ì‹¤ì‹œê°„ í†µê³„**: ì˜¤ëŠ˜ ë°©ë¬¸ì ìˆ˜, í˜ì´ì§€ë·°
- **íŠ¸ë˜í”½ ì¶”ì´**: 7ì¼/30ì¼ ì¼ë³„ ê·¸ë˜í”„
- **ì¸ê¸° í˜ì´ì§€**: í˜ì´ì§€ë·° ê¸°ì¤€ Top 10
- **ì¸ê¸° í¬ìŠ¤íŠ¸**: í¬ìŠ¤íŠ¸ë³„ í˜ì´ì§€ë·° Top 10 (ë„ë©”ì¸ë³„)
- **ì¸ê¸° ìœ ì… ê²½ë¡œ**: Referrer ê¸°ì¤€ Top 10
- **ì¸ê¸° í´ë¦­ ìš”ì†Œ**: í´ë¦­ ìˆ˜ ê¸°ì¤€ Top 20
- **í˜ì´ì§€ë³„ í´ë¦­ ìš”ì†Œ**: í˜ì´ì§€ë³„ í´ë¦­ í†µê³„ Top 10
- **Web Vitals**: ì„±ëŠ¥ ë©”íŠ¸ë¦­ (LCP, CLS, INP, FCP, TTFB, FID)
- **AI ë³´ê³ ì„œ**: AI ê¸°ë°˜ ì¸ì‚¬ì´íŠ¸ ìƒì„± ë° ì €ì¥
- **íˆíŠ¸ë§µ**: ë©”ì¸í˜ì´ì§€ íˆíŠ¸ë§µ ë³´ê¸° ë²„íŠ¼

### 7.3 ë‚ ì§œ ë²”ìœ„ ì„ íƒ

- ì‹œì‘ì¼/ì¢…ë£Œì¼ ì§ì ‘ ì„ íƒ
- 7ì¼/30ì¼ ë¹ ë¥¸ ì„ íƒ ë²„íŠ¼
- "ì™„ë£Œëœ ìº˜ë¦°ë” Nì¼" ê·œì¹™ ì ìš© (ì˜ˆ: ì˜¤ëŠ˜ì´ 12/25ì´ë©´ 7ì¼ = 12/18~12/24)

---

## 8. íˆíŠ¸ë§µ ê¸°ëŠ¥

### 8.1 íŒŒì¼ êµ¬ì¡°

```
components/admin/
  â”œâ”€â”€ HeatmapOverlay.tsx   # íˆíŠ¸ë§µ ìº”ë²„ìŠ¤ ë Œë”ë§
  â””â”€â”€ HeatmapViewer.tsx    # íˆíŠ¸ë§µ ë°ì´í„° í˜ì¹­ ë° UI

app/api/admin/
  â””â”€â”€ heatmap/
      â””â”€â”€ [pagePath]/
          â””â”€â”€ route.ts      # íˆíŠ¸ë§µ ë°ì´í„° API
```

### 8.2 íˆíŠ¸ë§µ v2 íŠ¹ì§•

- **Blob ë Œë”ë§**: ë¶€ë“œëŸ¬ìš´ ê·¸ë¼ë°ì´ì…˜ íˆíŠ¸ë§µ
- **ê³ í•´ìƒë„ ê·¸ë¦¬ë“œ**: 200x200 ê¸°ë³¸ (50~400 ì¡°ì ˆ ê°€ëŠ¥)
- **ë””ë°”ì´ìŠ¤ í•„í„°**: ì „ì²´/ëª¨ë°”ì¼/ë°ìŠ¤í¬í†±
- **ë¬¸ì„œ ê¸°ì¤€ ì¢Œí‘œ**: ìŠ¤í¬ë¡¤ ìœ„ì¹˜ ë³´ì •
- **ë·°í¬íŠ¸ ê³ ì • ìº”ë²„ìŠ¤**: ìŠ¤í¬ë¡¤ ì‹œ ì¦‰ì‹œ ë°˜ì‘
- **ì»¨íŠ¸ë¡¤ íŒ¨ë„**: ë°˜ê²½, ë¸”ëŸ¬, íˆ¬ëª…ë„ ì¡°ì ˆ

### 8.3 íˆíŠ¸ë§µ ë°ì´í„° ìˆ˜ì§‘

**í´ë¦­ ì´ë²¤íŠ¸ props**:
```typescript
{
  x: number;  // ë·°í¬íŠ¸ ê¸°ì¤€ X (0~1)
  y: number;  // ë·°í¬íŠ¸ ê¸°ì¤€ Y (0~1)
  page_x: number;  // ë¬¸ì„œ ê¸°ì¤€ X (0~1) - v2
  page_y: number;  // ë¬¸ì„œ ê¸°ì¤€ Y (0~1) - v2
  viewport_w: number;
  viewport_h: number;
  doc_w: number;  // ë¬¸ì„œ ì „ì²´ ë„ˆë¹„
  doc_h: number;  // ë¬¸ì„œ ì „ì²´ ë†’ì´
  scroll_x: number;
  scroll_y: number;
  device_bucket: 'mobile' | 'desktop';
  element_id: string | null;
  element_tag: string;
  href_host: string | null;
}
```

### 8.4 íˆíŠ¸ë§µ API

**GET /api/admin/heatmap/[pagePath]**

**ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°**:
- `days`: ê¸°ê°„ (ê¸°ë³¸: 30)
- `grid`: ê·¸ë¦¬ë“œ í•´ìƒë„ (ê¸°ë³¸: 200, ë²”ìœ„: 50~400)
- `device`: ë””ë°”ì´ìŠ¤ í•„í„° (all/mobile/desktop)

**ì‘ë‹µ**:
```typescript
{
  grid: Record<string, number>;  // "x,y": count
  stats: {
    totalClicks: number;
    uniqueElements: number;
    gridSize: number;
    dateRange: {
      start: string;
      end: string;
    };
    coordMode: 'page' | 'legacy' | 'none';
    filteredBy: {
      device: 'all' | 'mobile' | 'desktop';
    };
    samplingWarning?: string;
  };
}
```

---

## 9. AI ë³´ê³ ì„œ ê¸°ëŠ¥

### 9.1 íŒŒì¼ êµ¬ì¡°

```
app/api/
  â”œâ”€â”€ ai/
  â”‚   â””â”€â”€ analytics-report/
  â”‚       â””â”€â”€ route.ts      # AI ë³´ê³ ì„œ ìƒì„± API
  â””â”€â”€ admin/
      â””â”€â”€ analytics-reports/
          â”œâ”€â”€ route.ts      # ë³´ê³ ì„œ ëª©ë¡ API
          â””â”€â”€ [id]/
              â”œâ”€â”€ route.ts  # ë³´ê³ ì„œ ì¡°íšŒ API
              â””â”€â”€ comments/
                  â”œâ”€â”€ route.ts  # ëŒ“ê¸€ ëª©ë¡/ì‘ì„± API
                  â””â”€â”€ [commentId]/
                      â””â”€â”€ route.ts  # ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ API

lib/utils/
  â””â”€â”€ reportFormatter.ts    # AI ì…ë ¥ ë°ì´í„° í¬ë§·íŒ…
```

### 9.2 AI ë³´ê³ ì„œ ìƒì„±

**POST /api/ai/analytics-report**

**ìš”ì²­ ë³¸ë¬¸**:
```typescript
{
  reportType: 'daily' | 'weekly' | 'monthly' | 'custom';
  startDate?: string;  // YYYY-MM-DD
  endDate?: string;  // YYYY-MM-DD
  days?: number;  // ê¸°ë³¸: 7
  includeComparison?: boolean;  // ì´ì „ ê¸°ê°„ ë¹„êµ
  sitePrefix?: string;  // ê¸°ë³¸: ANALYTICS_PREFIX
}
```

**ì‘ë‹µ**:
```typescript
{
  report: {
    id: string;
    report_json: {
      summary: string;
      trends: Array<{...}>;
      insights: Array<{...}>;
      recommendations: Array<{...}>;
      performance: {
        webVitals: {
          metrics: Record<string, number>;
          summary: string;
        };
      };
      comparison?: {
        previousPeriod: {...};
        currentPeriod: {...};
        changes: {...};
      };
    };
    generated_at: string;
  };
  cached: boolean;  // ìºì‹œëœ ë³´ê³ ì„œì¸ì§€ ì—¬ë¶€
}
```

### 9.3 ìºì‹± ë©”ì»¤ë‹ˆì¦˜

- ì…ë ¥ ë°ì´í„° í•´ì‹œ (SHA-256) ê¸°ë°˜ ìºì‹±
- ê°™ì€ ì…ë ¥ = ê°™ì€ ë³´ê³ ì„œ ì¬ì‚¬ìš©
- `input_hash` ì»¬ëŸ¼ìœ¼ë¡œ ì¤‘ë³µ í™•ì¸

### 9.4 ë³´ê³ ì„œ ëŒ“ê¸€ ê¸°ëŠ¥

- ë³´ê³ ì„œë³„ ëŒ“ê¸€ ì‘ì„±/ìˆ˜ì •/ì‚­ì œ
- RLSë¡œ ë³¸ì¸ ëŒ“ê¸€ë§Œ ìˆ˜ì •/ì‚­ì œ ê°€ëŠ¥
- ì‘ì„±ì ì •ë³´ ìë™ ì €ì¥ (user_id, user_email, author_name)

---

## 10. ì´ì‹ ê°€ì´ë“œ

### 10.1 ë‹¨ê³„ë³„ ì´ì‹ ì ˆì°¨

#### Step 1: ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±

1. `supabase/migrations/` ë””ë ‰í† ë¦¬ì— ë§ˆì´ê·¸ë ˆì´ì…˜ íŒŒì¼ ìƒì„±
2. `{{prefix}}`ë¥¼ ì‹¤ì œ prefixë¡œ ì¹˜í™˜ (ì˜ˆ: `ustudio`, `modu`)
3. ë§ˆì´ê·¸ë ˆì´ì…˜ ì ìš©:
   ```bash
   # Supabase CLI ì‚¬ìš©
   supabase migration up
   
   # ë˜ëŠ” MCP ì‚¬ìš©
   mcp_supabase_apply_migration
   ```

#### Step 2: í™˜ê²½ ë³€ìˆ˜ ì„¤ì •

`.env.local` íŒŒì¼ì— ë‹¤ìŒ í™˜ê²½ ë³€ìˆ˜ ì¶”ê°€:
```bash
ANALYTICS_PREFIX=ustudio  # ë˜ëŠ” modu ë“±
ANALYTICS_ENABLED=true
ANALYTICS_SAMPLE_RATE_EVENTS=1.0
ANALYTICS_SAMPLE_RATE_HEATMAP=1.0
ANALYTICS_EXCLUDE_PATH_PREFIXES=/admin,/api,/_next
ANALYTICS_RESPECT_DNT=true
```

#### Step 3: íŒŒì¼ ë³µì‚¬

ë‹¤ìŒ íŒŒì¼ë“¤ì„ ìƒˆ í”„ë¡œì íŠ¸ë¡œ ë³µì‚¬:

```
# í•„ìˆ˜ íŒŒì¼
lib/config/analytics.ts
lib/utils/eventTracker.ts
lib/utils/tracking.ts
lib/queries/analytics.ts
components/analytics/Tracker.tsx
components/analytics/WebVitals.tsx
app/api/track/route.ts

# ëŒ€ì‹œë³´ë“œ (ì„ íƒ)
app/admin/dashboard/page.tsx
app/api/admin/dashboard/route.ts

# íˆíŠ¸ë§µ (ì„ íƒ)
components/admin/HeatmapOverlay.tsx
components/admin/HeatmapViewer.tsx
app/api/admin/heatmap/[pagePath]/route.ts

# AI ë³´ê³ ì„œ (ì„ íƒ)
app/api/ai/analytics-report/route.ts
app/api/admin/analytics-reports/route.ts
app/api/admin/analytics-reports/[id]/route.ts
app/api/admin/analytics-reports/[id]/comments/route.ts
app/api/admin/analytics-reports/[id]/comments/[commentId]/route.ts
lib/utils/reportFormatter.ts
```

#### Step 4: ì˜ì¡´ì„± ì„¤ì¹˜

```bash
npm install zod recharts
# ë˜ëŠ”
yarn add zod recharts
```

#### Step 5: Layoutì— Tracker ì¶”ê°€

```tsx
// app/layout.tsx
import { Suspense } from 'react';
import Tracker from '@/components/analytics/Tracker';
import WebVitals from '@/components/analytics/WebVitals';

export default function RootLayout({ children }) {
  return (
    <html>
      <body>
        {children}
        <Suspense fallback={null}>
          <Tracker />
          <WebVitals />
        </Suspense>
      </body>
    </html>
  );
}
```

#### Step 6: Supabase í´ë¼ì´ì–¸íŠ¸ ì„¤ì • í™•ì¸

`lib/supabase/client.ts` íŒŒì¼ì´ ì˜¬ë°”ë¥´ê²Œ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸:
- `createServerClient()` í•¨ìˆ˜ê°€ `SUPABASE_SERVICE_ROLE_KEY`ë¥¼ ì‚¬ìš©í•˜ëŠ”ì§€ í™•ì¸
- RLS ì •ì±…ì´ ì˜¬ë°”ë¥´ê²Œ ì ìš©ë˜ì—ˆëŠ”ì§€ í™•ì¸

#### Step 7: ë„ë©”ì¸ë³„ ì½˜í…ì¸  ë§¤í•‘ (ì˜µì…˜)

`app/api/track/route.ts`ì—ì„œ `post_id`/`about_id` ìë™ ë§¤í•‘ ë¡œì§ì„ ë„ë©”ì¸ì— ë§ê²Œ ìˆ˜ì •:

```typescript
// ì˜ˆ: ustudio í”„ë¡œì íŠ¸ì˜ ê²½ìš°
const { data: post } = await supabase
  .from('ustudio_posts')  // í…Œì´ë¸” ì´ë¦„ ë³€ê²½
  .select('id')
  .eq('slug', slug)
  .eq('locale', pathLocale)
  .eq('is_published', true)
  .single();
```

#### Step 8: ëŒ€ì‹œë³´ë“œ ë¼ìš°íŠ¸ ë³´í˜¸ (ì„ íƒ)

ëŒ€ì‹œë³´ë“œ ì ‘ê·¼ì„ ì¸ì¦ëœ ì‚¬ìš©ìë§Œ ê°€ëŠ¥í•˜ë„ë¡ ì„¤ì •:

```tsx
// app/admin/dashboard/page.tsx
import { redirect } from 'next/navigation';
import { createClient } from '@/lib/supabase/client';

export default async function DashboardPage() {
  const supabase = createClient();
  const { data: { session } } = await supabase.auth.getSession();
  
  if (!session) {
    redirect('/admin/login');
  }
  
  // ... ëŒ€ì‹œë³´ë“œ ë Œë”ë§
}
```

### 10.2 ì»¤ìŠ¤í„°ë§ˆì´ì§• í¬ì¸íŠ¸

#### 10.2.1 ì œì™¸ ê²½ë¡œ ì¶”ê°€

```typescript
// lib/config/analytics.ts
export const ANALYTICS_EXCLUDE_PATH_PREFIXES = (
  process.env.ANALYTICS_EXCLUDE_PATH_PREFIXES ||
  '/admin,/api,/_next,/custom-path'  // ì»¤ìŠ¤í…€ ê²½ë¡œ ì¶”ê°€
).split(',').map((p) => p.trim());
```

#### 10.2.2 ìƒ˜í”Œë§ ë¹„ìœ¨ ì¡°ì •

ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ëŒ€ë¹„:

```bash
ANALYTICS_SAMPLE_RATE_EVENTS=0.3  # 30% ìƒ˜í”Œë§
ANALYTICS_SAMPLE_RATE_HEATMAP=0.5  # 50% ìƒ˜í”Œë§
```

#### 10.2.3 ì„¸ì…˜ ë§Œë£Œ ì‹œê°„ ë³€ê²½

```typescript
// components/analytics/Tracker.tsx
const SESSION_EXPIRY_MS = 60 * 60 * 1000;  // 30ë¶„ â†’ 60ë¶„
```

#### 10.2.4 ì´ë²¤íŠ¸ í ì„¤ì • ë³€ê²½

```typescript
// lib/utils/eventTracker.ts
class EventQueue {
  private readonly FLUSH_INTERVAL = 10000;  // 5ì´ˆ â†’ 10ì´ˆ
  private readonly FLUSH_SIZE = 50;  // 20ê°œ â†’ 50ê°œ
}
```

### 10.3 ë°ì´í„° ì •ë¦¬ ìŠ¤ì¼€ì¤„ë§

Vercel Cron ë˜ëŠ” Supabase Edge Functionìœ¼ë¡œ ì£¼ê¸°ì  ì‹¤í–‰:

```json
// vercel.json
{
  "crons": [
    {
      "path": "/api/analytics/cleanup",
      "schedule": "0 17 * * *"  // UTC 17:00 (KST 02:00)
    }
  ]
}
```

```typescript
// app/api/analytics/cleanup/route.ts
import { createServerClient } from '@/lib/supabase/client';
import { getAnalyticsTableName } from '@/lib/config/analytics';

export async function GET() {
  const supabase = createServerClient();
  const prefix = process.env.ANALYTICS_PREFIX || 'uslab';
  
  const { data, error } = await supabase.rpc(
    `${prefix}_cleanup_old_tracking`
  );
  
  if (error) {
    return Response.json({ error: error.message }, { status: 500 });
  }
  
  return Response.json({ deleted: data });
}
```

### 10.4 í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] ì„¸ì…˜ ìƒì„± í™•ì¸ (localStorageì— ì„¸ì…˜ í‚¤ ì €ì¥)
- [ ] í˜ì´ì§€ë·° ì¶”ì  í™•ì¸ (ë°ì´í„°ë² ì´ìŠ¤ì— ê¸°ë¡)
- [ ] í´ë¦­ ì´ë²¤íŠ¸ ìˆ˜ì§‘ í™•ì¸ (íˆíŠ¸ë§µ ë°ì´í„° í™•ì¸)
- [ ] Web Vitals ìˆ˜ì§‘ í™•ì¸ (ëŒ€ì‹œë³´ë“œì—ì„œ í™•ì¸)
- [ ] Bot í•„í„°ë§ í™•ì¸ (ë´‡ User-Agentë¡œ í…ŒìŠ¤íŠ¸)
- [ ] ëŒ€ì‹œë³´ë“œ ë°ì´í„° í‘œì‹œ í™•ì¸
- [ ] íˆíŠ¸ë§µ ë Œë”ë§ í™•ì¸
- [ ] AI ë³´ê³ ì„œ ìƒì„± í™•ì¸
- [ ] RLS ì •ì±… í™•ì¸ (ë¹„ì¸ì¦ ì‚¬ìš©ìëŠ” ë°ì´í„° ì¡°íšŒ ë¶ˆê°€)

---

## 11. ì£¼ì˜ì‚¬í•­ ë° ì œí•œì‚¬í•­

### 11.1 ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­

- **í˜ì´ì§€ë„¤ì´ì…˜**: Supabase ê¸°ë³¸ ì œí•œ(1000í–‰) ëŒ€ì‘ì„ ìœ„í•´ ëª¨ë“  ì¿¼ë¦¬ì— í˜ì´ì§€ë„¤ì´ì…˜ ì ìš© í•„ìš”
- **ì¸ë±ìŠ¤**: ëŒ€ìš©ëŸ‰ ë°ì´í„° ëŒ€ë¹„ ì ì ˆí•œ ì¸ë±ìŠ¤ ì„¤ì • í•„ìˆ˜
- **ìƒ˜í”Œë§**: íŠ¸ë˜í”½ì´ ë§ì„ ê²½ìš° ìƒ˜í”Œë§ ë¹„ìœ¨ ì¡°ì • ê¶Œì¥

### 11.2 ë³´ì•ˆ ê³ ë ¤ì‚¬í•­

- **RLS ì •ì±…**: ëª¨ë“  í…Œì´ë¸”ì— RLS í™œì„±í™” í•„ìˆ˜
- **Service Role Key**: ì„œë²„ ì‚¬ì´ë“œì—ì„œë§Œ ì‚¬ìš©, í´ë¼ì´ì–¸íŠ¸ì— ë…¸ì¶œ ê¸ˆì§€
- **ì…ë ¥ ê²€ì¦**: Zod ìŠ¤í‚¤ë§ˆë¡œ ëª¨ë“  ì…ë ¥ ê²€ì¦

### 11.3 ë°ì´í„° ë³´ê´€ ê¸°ê°„

- ê¸°ë³¸ ë³´ê´€ ê¸°ê°„: 90ì¼
- `cleanup_old_tracking()` í•¨ìˆ˜ë¡œ ìë™ ì •ë¦¬
- í•„ìš” ì‹œ ë³´ê´€ ê¸°ê°„ ì¡°ì • ê°€ëŠ¥

### 11.4 GDPR ì¤€ìˆ˜

- Do Not Track í—¤ë” ì¡´ì¤‘ (`ANALYTICS_RESPECT_DNT`)
- ê°œì¸ì •ë³´ ìˆ˜ì§‘ ìµœì†Œí™” (IP ì£¼ì†Œ ë¯¸ìˆ˜ì§‘)
- ë°ì´í„° ì‚­ì œ ê¸°ëŠ¥ ì œê³µ (í–¥í›„ êµ¬í˜„)

---

## 12. ì°¸ê³  ìë£Œ

### 12.1 ê´€ë ¨ ë¬¸ì„œ

- `docs/íˆíŠ¸ë§µ_êµ¬í˜„_ë°©ì‹_ë³´ê³ ì„œ.md`: íˆíŠ¸ë§µ êµ¬í˜„ ìƒì„¸
- `docs/CLS_ê°œì„ _ë°©ì•ˆ.md`: Web Vitals CLS ê°œì„  ë°©ì•ˆ
- `docs/AI_ë³´ê³ ì„œ_ê¸°ëŠ¥_êµ¬í˜„_ëª…ì„¸ì„œ.md`: AI ë³´ê³ ì„œ ìƒì„¸ ëª…ì„¸

### 12.2 ì½”ë“œ ì°¸ì¡°

- `memory_bank/techContext.md`: ê¸°ìˆ  ìŠ¤íƒ ë° í™˜ê²½ ì •ë³´
- `memory_bank/activeContext.md`: í˜„ì¬ ì‘ì—… ìƒí™©
- `í†µê³„ì‹œìŠ¤í…œ.md`: í†µê³„ ì‹œìŠ¤í…œ ì„¤ê³„ ë¬¸ì„œ

---

## 13. ë²„ì „ ì •ë³´

- **ë¬¸ì„œ ë²„ì „**: 1.0
- **ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-01-25
- **ì‘ì„±ì**: AI Assistant
- **í”„ë¡œì íŠ¸**: USLab Web Analytics System

---

**ì´ ëª…ì„¸ì„œëŠ” USLab Web í”„ë¡œì íŠ¸ì˜ í†µê³„ ì‹œìŠ¤í…œì„ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ë¡œ ì´ì‹í•˜ê¸° ìœ„í•œ ì™„ì „í•œ ê°€ì´ë“œì…ë‹ˆë‹¤. ê° ì„¹ì…˜ì„ ìˆœì„œëŒ€ë¡œ ë”°ë¼í•˜ë©´ ë™ì¼í•œ í†µê³„ ê¸°ëŠ¥ì„ ìƒˆ í”„ë¡œì íŠ¸ì— êµ¬í˜„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.**


